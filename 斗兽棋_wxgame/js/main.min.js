var egret=window.egret,__reflect=this&&this.__reflect||function(t,e,a){t.__class__=e,a?a.push(e):a=[e],t.__types__=t.__types__?a.concat(t.__types__):a},__extends=this&&this.__extends||function(t,e){function a(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);a.prototype=e.prototype,t.prototype=new a},__awaiter=this&&this.__awaiter||function(t,e,a,n){return new(a||(a=Promise))(function(i,s){function o(t){try{h(n.next(t))}catch(e){s(e)}}function r(t){try{h(n["throw"](t))}catch(e){s(e)}}function h(t){t.done?i(t.value):new a(function(e){e(t.value)}).then(o,r)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function a(t){return function(e){return n([t,e])}}function n(a){if(i)throw new TypeError("Generator is already executing.");for(;h;)try{if(i=1,s&&(o=s[2&a[0]?"return":a[0]?"throw":"next"])&&!(o=o.call(s,a[1])).done)return o;switch(s=0,o&&(a=[0,o.value]),a[0]){case 0:case 1:o=a;break;case 4:return h.label++,{value:a[1],done:!1};case 5:h.label++,s=a[1],a=[0];continue;case 7:a=h.ops.pop(),h.trys.pop();continue;default:if(o=h.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){h=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){h.label=a[1];break}if(6===a[0]&&h.label<o[1]){h.label=o[1],o=a;break}if(o&&h.label<o[2]){h.label=o[2],h.ops.push(a);break}o[2]&&h.ops.pop(),h.trys.pop();continue}a=e.call(t,h)}catch(n){a=[6,n],s=0}finally{i=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var i,s,o,r,h={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r},ModalWindow=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.leftToCenter=function(t){t.x=-t.width,t.y=(Main.StageHeight-t.height)/2,egret.Tween.get(t).to({x:(Main.StageWidth-t.width)/2+30},400,egret.Ease.sineInOut).call(function(){egret.Tween.get(t).to({x:(Main.StageWidth-t.width)/2},30)})},e.prototype.centerLargen=function(t){var e=t.width,a=t.height;t.width=0,t.height=0,t.x=(Main.StageWidth-t.width)/2,t.y=(Main.StageHeight-t.height)/2,egret.Tween.get(t).to({width:e+20},400,egret.Ease.sineInOut).call(function(){egret.Tween.get(t).to({x:a},20)})},e.prototype.centerToRight=function(t,e){egret.Tween.get(t).to({x:Main.StageWidth},400,egret.Ease.sineInOut).call(function(){e&&e()})},e}(egret.DisplayObjectContainer);__reflect(ModalWindow.prototype,"ModalWindow");var MatchPage=function(t){function e(a,n){var i=t.call(this)||this;return i.once(egret.Event.ADDED_TO_STAGE,function(t){e.instance=i,i.isFriendsMatch=a,i.to_uid=n,i.init(),Main.addBanner(i)},i),i.once(egret.Event.REMOVED_FROM_STAGE,function(t){e.instance=null,Main.hideBanner(),i.matchRobotTimer&&(clearTimeout(i.matchRobotTimer),i.matchRobotTimer=null)},i),i}return __extends(e,t),e.prototype.init=function(){this.addBg(),this.addReurnChooseLevelPage(),this.addRotateAnimation(),this.starMatching(),this.addPlayerInfo(),this.addBtns()},e.prototype.addBg=function(){var t=GlueUtils.createImg("matchPageBg_jpg",Main.StageWidth,Main.StageHeight,Main.StageWidth/2,Main.StageHeight/2);t.scale9Grid=new egret.Rectangle(0,1330,750,1334),this.addChild(t)},e.prototype.addReurnChooseLevelPage=function(){var t=this.gotoChooseLevelPage.bind(this),e=new Button({url:"window_return_png",width:80,height:80,x:62,y:90*Main.K_H,filter:[],callBack:t});this.addChild(e),GlueUtils.removedListener(e,egret.TouchEvent.TOUCH_TAP,t,this)},e.prototype.gotoChooseLevelPage=function(){GlueUtils.RemoveChild(this),Main.Stage.addChild(new ChooseLevelPage),Socket.getInstance().closeTunnel(),Socket.getInstance().removeAllEventListener()},e.prototype.addRotateAnimation=function(){var t=GlueUtils.createBitmapByName("rotateIcon_png");t.width=296,t.height=296,t.anchorOffsetX=140,t.anchorOffsetY=150,t.x=Main.StageWidth/2,t.y=546,this.addChild(t),egret.Tween.get(t,{loop:!0}).to({rotation:360},5e3);var e=GlueUtils.createBitmapByName("rotateIcon1_png");e.width=446,e.height=446,e.anchorOffsetX=228,e.anchorOffsetY=214,e.x=Main.StageWidth/2,e.y=546,this.addChild(e),egret.Tween.get(e,{loop:!0}).to({rotation:-360},4e3)},e.prototype.addPlayerInfo=function(){var t=new egret.TextField;t.width=this.width,t.textAlign=egret.HorizontalAlign.CENTER,t.lineSpacing=20,t.x=0,t.y=900*Main.K_H,t.size=36,t.textColor=4953233,t.text=DataMgr.getInstance().userData.nickName+"\n来自："+DataMgr.getInstance().userData.city+"\n"+DataMgr.getInstance().gameData_LG.levelTitle[BusUtils.getLevelByStar()],this.addChild(t)},e.prototype.addBtns=function(){},e.prototype.starMatching=function(){var t=this;this.isFriendsMatch?Socket.getInstance().openTunnel(4,this.to_uid).then(function(e){Socket.getInstance().addSocketListener();var a=t.messageRule.bind(t);Socket.getInstance().addEventListener(SocketEvent.message,a)})["catch"](function(t){wx.showToast({title:"连接网络失败，请稍后再试",icon:"none",duration:3e3})}):Socket.getInstance().openTunnel(0).then(function(e){Socket.getInstance().addSocketListener();var a=t.messageRule.bind(t);Socket.getInstance().addEventListener(SocketEvent.message,a);var n=12e3;t.matchRobotTimer=setTimeout(function(){Socket.getInstance().closeTunnel(),Socket.getInstance().removeAllEventListener(),Robot.getInstance().RobotReady(),clearTimeout(t.matchRobotTimer),t.matchRobotTimer=null},n+_.random(1e3,5e3))})["catch"](function(t){wx.showToast({title:"连接网络失败，请稍后再试",icon:"none",duration:3e3})})},e.prototype.messageRule=function(t){switch(t.act){case-1:GamePage.instance&&GamePage.instance.parent&&GamePage.instance.listen_OffLine();break;case 1:clearTimeout(this.matchRobotTimer),this.matchRobotTimer=null,console.log("匹配成功",t),DataMgr.getInstance().userData.matchingData={chessData:t.chess_data,myTeam:"red"===t.color?"r":"b",enemyTeam:"red"===t.color?"b":"r",enemyUserInfo:t.userinfo[0],enemyUid:String(t.to_uid)},this.navGamePage();break;case 2:if(!GamePage.instance||!GamePage.instance.parent)return;switch(t.data[0].status){case 0:GamePage.instance.listen_ClickEgg(t.data[1].animal);break;case 1:GamePage.instance.listen_MoveAnimal(t.data[1].beFloatedAnimal,t.data[1].target,"r"===t.data[1].target.slice(0,1)||"b"===t.data[1].target.slice(0,1));break;case 2:GamePage.instance.listen_Peace();break;case 3:GamePage.instance.listen_ComfirePeace();break;case 4:GamePage.instance.listen_RefusePeace();break;case 5:GamePage.instance.listen_Quit();break;case 6:GameOverPage.instance.listen_PlayAgain();break;case 7:GamePage.instance.listen_Emoj(t.data[0].emojNumber);break;case 8:GamePage.instance.listen_TextMsg(t.data[0].textMsg);break;case 9:GamePage.instance.listen_TangleLose();break;case 10:GamePage.instance.listen_TangleTie()}break;case 3:GameOverPage.instance&&GameOverPage.instance.parent&&GameOverPage.instance.listen_LeaveRoom();break;case 4:this.navGamePage();break;case 5:console.info("准备好再来一局，等待服务器发新棋盘过来，触发cat=1");break;case 9:Socket.getInstance().sendMessage(t);break;case 10:wx.showToast({title:t.data.msg,icon:"none",duration:2500});var e=setTimeout(function(){Main.Stage.removeChildren(),Main.Stage.addChild(new IndexPage),Socket.getInstance().closeTunnel(),Socket.getInstance().removeAllEventListener(),clearTimeout(e),e=null},1500)}},e.prototype.navGamePage=function(t){void 0===t&&(t=!1),GamePage.instance&&GamePage.instance.parent?(GlueUtils.RemoveChild(GamePage.instance),GamePage.instance=null,Main.Stage.addChild(new GamePage(t))):(GlueUtils.RemoveChild(e.instance),e.instance=null,Main.Stage.addChild(new GamePage(t)))},e}(egret.DisplayObjectContainer);__reflect(MatchPage.prototype,"MatchPage");var GamePage=function(t){function e(a){var n=t.call(this)||this;return n.isRobotModel=!1,n.once(egret.Event.ADDED_TO_STAGE,function(t){e.instance=n,n.isRobotModel=a,n.resetGameData();try{n.addAdjunct()}catch(i){console.error(i)}n.animalsInit(),n.addClickListener()},n),n.once(egret.Event.REMOVED_FROM_STAGE,function(t){e.instance=null},n),n}return __extends(e,t),e.prototype.addAdjunct=function(){function t(){var t=new HelpPage;this.addChild(t)}function e(t,e){var a=new egret.Bitmap(t);a.width=60,a.height=60,a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,a.x=164,a.y=122*Main.K_H,this.addChild(a),egret.Tween.get(a).to({x:a.x+_.random(0,200),y:a.y+_.random(180,220)},1e3,egret.Ease.sineIn).to({alpha:0},200),this.notice_Emoj(e)}var a=GlueUtils.createImg("gameBG_jpg",Main.StageWidth,Main.StageHeight,Main.StageWidth/2,Main.StageHeight/2);this.addChild(a);var n=GlueUtils.createImg("game_json.help_png",54,76,50,250);n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,t,this),GlueUtils.removedListener(n,egret.TouchEvent.TOUCH_TAP,t,this),this.addChild(n),RES.getResByUrl(DataMgr.getInstance().userData.avatarUrl,function(t){var e=new egret.Bitmap(t);e.width=110,e.height=e.width,e.anchorOffsetX=.5*e.width,e.anchorOffsetY=.5*e.height,e.x=164,e.y=122*Main.K_H;var a=new egret.Shape;a.graphics.beginFill(255),a.graphics.drawCircle(e.x,e.y,e.width/2),a.graphics.endFill(),this.addChild(a),e.mask=a;var n=new egret.Shape,i="r"===DataMgr.getInstance().userData.matchingData.myTeam?16299012:4502007;n.graphics.beginFill(i),n.graphics.lineStyle(18,i),n.graphics.drawCircle(e.x,e.y,.5*e.width),n.graphics.endFill(),this.addChild(n),this.addChild(e)},this,RES.ResourceItem.TYPE_IMAGE);var i=GlueUtils.createBitmapByName("game_json.game_icon1_png");i.width=140,i.height=44,i.x=174,i.y=166*Main.K_H,this.addChildAt(i,1);var s;s=1===DataMgr.getInstance().userData.gender?"game_json.man_png":"game_json.woman_png";var o=GlueUtils.createBitmapByName(s);o.width=32,o.height=o.width,o.x=182,o.y=170*Main.K_H,this.addChild(o);var r=new egret.TextField;r.width=100,r.x=224,r.y=174*Main.K_H,r.size=24,r.textColor=16777215,r.text=DataMgr.getInstance().userData.nickName.slice(0,3),this.addChild(r),RES.getResByUrl(DataMgr.getInstance().userData.matchingData.enemyUserInfo.avatarUrl,function(t){var e=new egret.Bitmap(t);e.width=110,e.height=e.width,e.anchorOffsetX=.5*e.width,e.anchorOffsetY=.5*e.height,e.x=594,e.y=122*Main.K_H;var a=new egret.Shape;a.graphics.beginFill(255),a.graphics.drawCircle(e.x,e.y,e.width/2),a.graphics.endFill(),this.addChild(a),e.mask=a;var n=new egret.Shape,i="r"===DataMgr.getInstance().userData.matchingData.enemyTeam?16299012:4502007;n.graphics.beginFill(i),n.graphics.lineStyle(18,i),n.graphics.drawCircle(e.x,e.y,.5*e.width),n.graphics.endFill(),this.addChild(n),this.addChild(e)},this,RES.ResourceItem.TYPE_IMAGE);var h=GlueUtils.createBitmapByName("game_json.game_icon1_png");h.width=140,h.height=44,h.x=426,h.y=166*Main.K_H,this.addChildAt(h,1);var d;d=1===DataMgr.getInstance().userData.matchingData.enemyUserInfo.gender?"game_json.man_png":"game_json.woman_png";var c=GlueUtils.createBitmapByName(d);c.width=32,c.height=c.width,c.x=528,c.y=170*Main.K_H,this.addChild(c);var g=new egret.TextField;g.width=100,g.x=414,g.y=174*Main.K_H,g.size=24,g.textColor=16777215,g.textAlign=egret.HorizontalAlign.RIGHT,g.text=DataMgr.getInstance().userData.matchingData.enemyUserInfo.nickName.slice(0,3),this.addChild(g),this.timeWarnImg=new egret.Bitmap,this.timeWarnImg.texture=RES.getRes("game_json.redHHBit_png"),this.changeTimeWarnImg(),this.timeWarnImg.width=292,this.timeWarnImg.height=76,this.timeWarnImg.anchorOffsetX=this.timeWarnImg.width/2,this.timeWarnImg.anchorOffsetY=this.timeWarnImg.height/2,this.timeWarnImg.x=375,this.timeWarnImg.y=120*Main.K_H,this.addChild(this.timeWarnImg),this.timeWarnSecText=new egret.TextField,this.changTimeWarnSec(),this.timeWarnSecText.textColor=16777215,this.timeWarnSecText.width=220,this.timeWarnSecText.textAlign=egret.HorizontalAlign.CENTER,this.timeWarnSecText.anchorOffsetX=this.timeWarnSecText.width/2,this.timeWarnSecText.anchorOffsetY=this.timeWarnSecText.height/2,this.timeWarnSecText.y=120*Main.K_H,this.addChild(this.timeWarnSecText);var l=GlueUtils.createBitmapByName("singleTextMsg_png");l.width=550,l.height=44,l.x=(Main.StageWidth-l.width)/2,l.y=304*Main.K_H,this.addChild(l),this.textMsg=new egret.TextField,this.textMsg.text="",this.textMsg.size=28,this.textMsg.x=200,this.textMsg.y=310*Main.K_H,this.addChild(this.textMsg);var u=this.updateTextMsg.bind(this);DataMgr.getInstance().addEventListener(DataEvent.SEND_TEXT_MSG,u),this.textMsg.once(egret.Event.REMOVED_FROM_STAGE,function(){DataMgr.getInstance().removeEventListener(DataEvent.SEND_TEXT_MSG,u)},this);var m=GlueUtils.createBitmapByName("peaceBtn_png");m.width=162,m.height=74,m.x=94,m.y=224*Main.K_H,m.touchEnabled=!0,m.addEventListener(egret.TouchEvent.TOUCH_TAP,this.notice_Peace,this),GlueUtils.removedListener(m,egret.TouchEvent.TOUCH_TAP,this.notice_Peace,this),this.addChild(m);var p=GlueUtils.createBitmapByName("quitBtn_png");p.width=162,p.height=74,p.x=298,p.y=224*Main.K_H,p.touchEnabled=!0,p.once(egret.TouchEvent.TOUCH_TAP,this.notice_Quit,this),this.addChild(p),this.propContainer=new egret.DisplayObjectContainer,this.propContainer.width=154,this.propContainer.height=238,this.propContainer.x=494,this.propContainer.y=224*Main.K_H,this.propContainer.visible=!1,this.addChild(this.propContainer);var v=GlueUtils.createBitmapByName("propBg_png");v.y=2,v.width=this.propContainer.width,v.height=this.propContainer.height,this.propContainer.addChild(v),this.mouseBtn=GlueUtils.createBitmapByName("prop_mouse_png"),this.mouseBtn.width=136,this.mouseBtn.height=66,this.mouseBtn.x=2,this.mouseBtn.y=74,DataMgr.getInstance().userData.gameProps.mouseCard>0?(this.mouseBtn.touchEnabled=!0,this.mouseBtn.once(egret.TouchEvent.TOUCH_TAP,this.findEnemyMouse,this)):this.mouseBtn.filters=[new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0])],this.propContainer.addChild(this.mouseBtn),this.calcuCardBtn=GlueUtils.createBitmapByName("prop_calcu_png"),this.calcuCardBtn.width=136,this.calcuCardBtn.height=66,this.calcuCardBtn.x=2,this.calcuCardBtn.y=152,DataMgr.getInstance().userData.gameProps.countCard>0?(this.calcuCardBtn.touchEnabled=!0,this.calcuCardBtn.once(egret.TouchEvent.TOUCH_TAP,this.findEnemyChesses,this)):this.calcuCardBtn.filters=[new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0])],this.propContainer.addChild(this.calcuCardBtn),this.propsBtn=GlueUtils.createBitmapByName("propBtn_png"),this.propsBtn.width=162,this.propsBtn.height=74,this.propsBtn.x=494,this.propsBtn.y=224*Main.K_H,this.propsBtn.touchEnabled=!0,this.propsBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showProps,this),GlueUtils.removedListener(this.propsBtn,egret.TouchEvent.TOUCH_TAP,this.showProps,this),this.addChild(this.propsBtn);var w=GlueUtils.createBitmapByName("gameGZbg_png");w.width=708,w.height=640,w.x=(Main.StageWidth-w.width)/2,w.y=426*Main.K_H,this.addChild(w);var f=GlueUtils.createBitmapByName("game_json.guizeBit_png");f.width=660,f.height=60,f.x=(Main.StageWidth-f.width)/2,f.y=1116*Main.K_H,this.addChild(f);var D=GlueUtils.createBitmapByName("game_json.guizebqBG_png");D.width=726,D.height=90,D.x=(Main.StageWidth-D.width)/2,D.y=1198*Main.K_H,this.addChild(D),this.emoj1=GlueUtils.createBitmapByName("game_json.biaoqing1_png"),this.emoj1.texture=RES.getRes("game_json.biaoqing1_png"),this.emoj1.width=60,this.emoj1.height=60,this.emoj1.x=220,this.emoj1.y=1216*Main.K_H,this.emoj1.touchEnabled=!0,this.emojEmitterBind1=e.bind(this,this.emoj1.texture,1,null),this.emoj1.addEventListener(egret.TouchEvent.TOUCH_TAP,this.emojEmitterBind1,this),GlueUtils.removedListener(this.emoj1,egret.TouchEvent.TOUCH_TAP,this.emojEmitterBind1,this),this.addChild(this.emoj1),this.emoj2=GlueUtils.createBitmapByName("game_json.biaoqing2_png"),this.emoj2.texture=RES.getRes("game_json.biaoqing2_png"),this.emoj2.width=60,this.emoj2.height=60,this.emoj2.x=320,this.emoj2.y=1216*Main.K_H,this.emoj2.touchEnabled=!0,this.emojEmitterBind2=e.bind(this,this.emoj2.texture,2,null),this.emoj2.addEventListener(egret.TouchEvent.TOUCH_TAP,this.emojEmitterBind2,this),GlueUtils.removedListener(this.emoj2,egret.TouchEvent.TOUCH_TAP,this.emojEmitterBind2,this),this.addChild(this.emoj2),this.emoj3=GlueUtils.createBitmapByName("game_json.biaoqing3_png"),this.emoj3.texture=RES.getRes("game_json.biaoqing3_png"),this.emoj3.width=60,this.emoj3.height=60,this.emoj3.x=412,this.emoj3.y=1216*Main.K_H,this.emoj3.touchEnabled=!0,this.emojEmitterBind3=e.bind(this,this.emoj3.texture,3,null),this.emoj3.addEventListener(egret.TouchEvent.TOUCH_TAP,this.emojEmitterBind3,this),GlueUtils.removedListener(this.emoj3,egret.TouchEvent.TOUCH_TAP,this.emojEmitterBind3,this),this.addChild(this.emoj3),this.emoj4=GlueUtils.createBitmapByName("game_json.biaoqing4_png"),this.emoj4.texture=RES.getRes("game_json.biaoqing4_png"),this.emoj4.width=60,this.emoj4.height=60,this.emoj4.x=510,this.emoj4.y=1216*Main.K_H,this.emoj4.touchEnabled=!0,this.emojEmitterBind4=e.bind(this,this.emoj4.texture,4,null),this.emoj4.addEventListener(egret.TouchEvent.TOUCH_TAP,this.emojEmitterBind4,this),GlueUtils.removedListener(this.emoj4,egret.TouchEvent.TOUCH_TAP,this.emojEmitterBind4,this),this.addChild(this.emoj4);var y=GlueUtils.createImg("write_png",102,58,136,1198*Main.K_H+46);y.touchEnabled=!0,y.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showDialog,this),GlueUtils.removedListener(y,egret.TouchEvent.TOUCH_TAP,this.showDialog,this),this.addChild(y),this.preTextMsgBtn=GlueUtils.createImg("chat_1_png",44,86,634,1198*Main.K_H+44),this.preTextMsgBtn.touchEnabled=!0,this.preTextMsgBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showPreDialog,this),GlueUtils.removedListener(this.preTextMsgBtn,egret.TouchEvent.TOUCH_TAP,this.showPreDialog,this),this.addChild(this.preTextMsgBtn),DataMgr.getInstance().addEventListener(DataEvent.HIDE_PRE_DIALOG,this.hidePreDialog),this.once(egret.Event.REMOVED_FROM_STAGE,function(){DataMgr.getInstance().removeEventListener(DataEvent.HIDE_PRE_DIALOG,this.hidePreDialog)},this)},e.prototype.addPrevPlayChess=function(t,e){this.removePrevPlayChess(),this.shangyishouImg=GlueUtils.createImg("shangyishou_png",80,30,t+50,e-90),this.addChild(this.shangyishouImg)},e.prototype.removePrevPlayChess=function(){this.shangyishouImg&&(GlueUtils.RemoveChild(this.shangyishouImg),this.shangyishouImg=null)},e.prototype.hidePreDialog=function(){e.instance.preTextMsgBtn.texture=RES.getRes("chat_1_png"),GlueUtils.RemoveChild(e.instance.preDialog)},e.prototype.showPreDialog=function(){this.preDialog&&this.preDialog.parent?this.hidePreDialog():(this.preTextMsgBtn.texture=RES.getRes("chat_2_png"),this.preDialog=new PreDialog,this.preDialog.x=220,this.preDialog.y=1200*Main.K_H-666,this.addChild(this.preDialog))},e.prototype.findEnemyMouse=function(){for(var t in this.animals)if(t===("r"===DataMgr.getInstance().userData.matchingData.enemyTeam?"r_1":"b_1")){if(this.animals[t].getIsOpen())return void wx.showToast({title:"敌方老鼠已打开",icon:"none",duration:2500});var e=GlueUtils.createImg("mouseHead_png",46,46,0,-56);return e.name="mouseHead",this.animals[t].addChild(e),this.propContainer.visible=!1,this.mouseBtn.filters=[new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0])],void DataMgr.getInstance().userData.gameProps.mouseCard--}wx.showToast({title:"敌方老鼠已被吃掉",icon:"none",duration:2500})},e.prototype.findEnemyChesses=function(){var t="r"===DataMgr.getInstance().userData.matchingData.enemyTeam?new egret.ColorMatrixFilter([.3,.6,0,0,100,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]):new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,100,0,0,0,1,0]);for(var e in this.animals)this.animals[e].getColor()===DataMgr.getInstance().userData.matchingData.enemyTeam&&this.animals[e].changeEggColor(t);this.propContainer.visible=!1,this.calcuCardBtn.filters=[new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0])],DataMgr.getInstance().userData.gameProps.countCard--},e.prototype.showProps=function(){this.setChildIndex(this.propContainer,this.numChildren-1),this.setChildIndex(this.propsBtn,this.numChildren),this.propContainer.visible===!1?this.propContainer.visible=!0:this.propContainer.visible=!1},e.prototype.showDialog=function(){var t=new Dialog;this.addChild(t)},e.prototype.updateTextMsg=function(){this.textMsg.textColor="r"===DataMgr.getInstance().tempData.msgText[DataMgr.getInstance().tempData.msgText.length-1][0]?16711680:3179261,this.textMsg.text=DataMgr.getInstance().tempData.msgText[DataMgr.getInstance().tempData.msgText.length-1][1]},e.prototype.resetGameData=function(){this.canPlayTeam="r",this.grid=new Grid(4,4,548,536,100,476*Main.K_H),this.animals={},this.lawns={},this.beFloatedAnimal=null,this.moveDirection=[],this.isGameOver=!1,this.isAnimalMoving=!1,this.requestPeaceNumber=1,this.preEatLawnAniamlId=null,this.eatLawnNumber=0},e.prototype.animalsInit=function(){var t=this;Object.keys(DataMgr.getInstance().userData.matchingData.chessData).forEach(function(e,a){var n=new Animal(e);t.animals[e]=n,n.x=t.grid.coordinate[DataMgr.getInstance().userData.matchingData.chessData[e]][0],n.y=t.grid.coordinate[DataMgr.getInstance().userData.matchingData.chessData[e]][1],t.addChild(n)})},e.prototype.addClickListener=function(){this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickChess,this),GlueUtils.removedListener(this,egret.TouchEvent.TOUCH_TAP,this.clickChess,this)},e.prototype.clickChess=function(t){var e=this;if(!this.isGameOver){if(this.canPlayTeam!==DataMgr.getInstance().userData.matchingData.myTeam)return void wx.showToast({title:"等待对手走棋",icon:"none",duration:1500});if(this.isAnimalMoving)return void wx.showToast({title:"您走得太快了",icon:"none",duration:1500});if(t.target instanceof Animal){var a=t.target;this.beFloatedAnimal&&a.getIsOpen()?this.beFloatedAnimal===a?this.floatAnimalCancel():a.getColor()===DataMgr.getInstance().userData.matchingData.myTeam?(this.floatAnimalCancel(),this.floatAnimal(a)):this.canEatOtherChess(a)&&(this.notice_MoveAnimal(this.beFloatedAnimal.getId(),a.getId()),this.eatOtherChess(a),this.eatLawnNumber=0,this.preEatLawnAniamlId=null):this.beFloatedAnimal&&!a.getIsOpen()?(this.floatAnimalCancel(),this.isAnimalMoving=!0,this.notice_OpenEgg(a.getId()),this.eatLawnNumber=0,this.preEatLawnAniamlId=null,this.removePrevPlayChess(),a.openEgg(!0,function(){e.addPrevPlayChess(a.x,a.y),e.isAnimalMoving=!1,e.changeCanPlayTeam()})):a.getIsOpen()===!1?(this.isAnimalMoving=!0,this.notice_OpenEgg(a.getId()),this.eatLawnNumber=0,this.preEatLawnAniamlId=null,this.removePrevPlayChess(),a.openEgg(!0,function(){e.addPrevPlayChess(a.x,a.y),e.isAnimalMoving=!1,e.changeCanPlayTeam(),("r_1"===a.getId()||"b_1"===a.getId())&&GlueUtils.RemoveChild(a.getChildByName("mouseHead"))})):a.getColor()===DataMgr.getInstance().userData.matchingData.myTeam?(this.beFloatedAnimal=a,this.floatAnimal(a)):wx.showToast({title:"这是对方棋子",icon:"none",duration:1500})}else if(t.target instanceof Lawn&&this.beFloatedAnimal){var n=t.target;this.canEatLawn(n)&&(this.notice_MoveAnimal(this.beFloatedAnimal.getId(),n.getPosition()),this.preEatLawnAniamlId===this.beFloatedAnimal.getId()?this.eatLawnNumber++:this.eatLawnNumber=0,this.preEatLawnAniamlId=this.beFloatedAnimal.getId(),this.eatLawn(n,function(){e.hasSmallerChessAround(e.animals[e.preEatLawnAniamlId])||e.isRobotModel||(e.eatLawnNumber=0),e.eatLawnNumber>4&&e.eatLawnNumber<=6?(AudioMgr.getInstance().sound_notice(),e.isSingleChess()||wx.showToast({title:"警告：穷追不舍将判定为负",icon:"none",duration:3500})):e.eatLawnNumber>6&&(e.isSingleChess()?(e.overGame(GameOverResult.TIE),e.notice_TangleTie(),wx.showToast({title:"长期吃不到棋判定为和棋",icon:"none",duration:3500})):(e.overGame(GameOverResult.LOSE),e.notice_TangleLose(),wx.showToast({title:"您因为穷追不舍被判定为负",icon:"none",duration:3500})))}))}}},e.prototype.hasSmallerChessAround=function(t){for(var e=!1,a=DataMgr.getInstance().userData.matchingData.chessData,n=Number(a[t.getId()].slice(0,1))-1+a[t.getId()].slice(1),i=Number(a[t.getId()].slice(0,1))+1+a[t.getId()].slice(1),s=a[t.getId()].slice(0,1)+(Number(a[t.getId()].slice(1))-1),o=a[t.getId()].slice(0,1)+(Number(a[t.getId()].slice(1))+1),r=0,h=Object.keys(this.animals);r<h.length;r++){var d=h[r];if(a[d]===s){var c=this.animals[d];if(c&&c.getIsOpen()&&c.getColor()!==t.getColor())return!0}else if(a[d]===o){var c=this.animals[d];if(c&&c.getIsOpen()&&c.getColor()!==t.getColor())return!0}else if(a[d]===n){var c=this.animals[d];if(c&&c.getIsOpen()&&c.getColor()!==t.getColor())return!0}else if(a[d]===i){var c=this.animals[d];if(c&&c.getIsOpen()&&c.getColor()!==t.getColor())return!0}}return e},e.prototype.canEatOtherChess=function(t){var e=this,a=!1,n=DataMgr.getInstance().userData.matchingData.chessData;return this.moveDirection.forEach(function(i,s){if(i===Direction.LEFT){var o=Number(n[e.beFloatedAnimal.getId()].slice(0,1))-1+n[e.beFloatedAnimal.getId()].slice(1);n[t.getId()]===o&&t.getColor()!==e.beFloatedAnimal.getColor()&&(a=!0)}else if(i===Direction.RIGHT){var o=Number(n[e.beFloatedAnimal.getId()].slice(0,1))+1+n[e.beFloatedAnimal.getId()].slice(1);n[t.getId()]===o&&t.getColor()!==e.beFloatedAnimal.getColor()&&(a=!0)}else if(i===Direction.UP){var o=n[e.beFloatedAnimal.getId()].slice(0,1)+(Number(n[e.beFloatedAnimal.getId()].slice(1))-1);n[t.getId()]===o&&t.getColor()!==e.beFloatedAnimal.getColor()&&(a=!0)}else if(i===Direction.DOWN){var o=n[e.beFloatedAnimal.getId()].slice(0,1)+(Number(n[e.beFloatedAnimal.getId()].slice(1))+1);n[t.getId()]===o&&t.getColor()!==e.beFloatedAnimal.getColor()&&(a=!0)}}),a},e.prototype.canEatLawn=function(t){var e=this,a=!1,n=DataMgr.getInstance().userData.matchingData.chessData;return this.moveDirection.forEach(function(i,s){if(i===Direction.LEFT){var o=Number(n[e.beFloatedAnimal.getId()].slice(0,1))-1+n[e.beFloatedAnimal.getId()].slice(1);t.getPosition()===o&&(a=!0)}else if(i===Direction.RIGHT){var o=Number(n[e.beFloatedAnimal.getId()].slice(0,1))+1+n[e.beFloatedAnimal.getId()].slice(1);t.getPosition()===o&&(a=!0)}else if(i===Direction.UP){var o=n[e.beFloatedAnimal.getId()].slice(0,1)+(Number(n[e.beFloatedAnimal.getId()].slice(1))-1);t.getPosition()===o&&(a=!0)}else if(i===Direction.DOWN){var o=n[e.beFloatedAnimal.getId()].slice(0,1)+(Number(n[e.beFloatedAnimal.getId()].slice(1))+1);t.getPosition()===o&&(a=!0)}}),a},e.prototype.eatOtherChess=function(t){var e=this;this.removePrevPlayChess(),this.removeArrows();var a=DataMgr.getInstance().userData.matchingData.chessData;this.isAnimalMoving=!0,this.addLawn(a[this.beFloatedAnimal.getId()]);var n=this.grid.coordinate[a[t.getId()]];egret.Tween.get(this.beFloatedAnimal).to({x:n[0],y:n[1]},100).call(function(){var t=new egret.MovieClip(new egret.MovieClipDataFactory(RES.getRes("yanMV_json"),RES.getRes("yanMV_png")).generateMovieClipData());t.x=n[0]-50,t.y=n[1],e.addChild(t),t.gotoAndPlay(1,1),t.once(egret.Event.COMPLETE,function(){this.addPrevPlayChess(n[0],n[1]),GlueUtils.RemoveChild(t),t=null},e)}),this.beFloatedAnimal.getNumber()>t.getNumber()?8===this.beFloatedAnimal.getNumber()&&1===t.getNumber()?(delete this.animals[this.beFloatedAnimal.getId()],GlueUtils.RemoveChild(this.beFloatedAnimal),AudioMgr.getInstance().sound_chi()):(a[this.beFloatedAnimal.getId()]=a[t.getId()],delete this.animals[t.getId()],GlueUtils.RemoveChild(t),AudioMgr.getInstance().sound_zha()):this.beFloatedAnimal.getNumber()<t.getNumber()?1===this.beFloatedAnimal.getNumber()&&8===t.getNumber()?(a[this.beFloatedAnimal.getId()]=a[t.getId()],delete this.animals[t.getId()],GlueUtils.RemoveChild(t),AudioMgr.getInstance().sound_zha()):(delete this.animals[this.beFloatedAnimal.getId()],GlueUtils.RemoveChild(this.beFloatedAnimal),AudioMgr.getInstance().sound_chi()):(delete this.animals[t.getId()],GlueUtils.RemoveChild(t),delete this.animals[this.beFloatedAnimal.getId()],GlueUtils.RemoveChild(this.beFloatedAnimal),this.addLawn(a[t.getId()]),AudioMgr.getInstance().sound_chi());var i=setTimeout(function(){e.isAnimalMoving=!1,e.beFloatedAnimal=null,e.moveDirection=[],e.changeCanPlayTeam();var t=e.checkWhoIsWinner();t&&("r"===t?"r"===DataMgr.getInstance().userData.matchingData.myTeam?e.overGame(GameOverResult.WIN):e.overGame(GameOverResult.LOSE):"b"===t?"b"===DataMgr.getInstance().userData.matchingData.myTeam?e.overGame(GameOverResult.WIN):e.overGame(GameOverResult.LOSE):"tie"===t&&e.overGame(GameOverResult.TIE)),clearTimeout(i),i=null},300)},e.prototype.eatLawn=function(t,e){var a=this;this.removePrevPlayChess(),this.isAnimalMoving=!0;var n=DataMgr.getInstance().userData.matchingData.chessData;this.addLawn(n[this.beFloatedAnimal.getId()]);var i=this.grid.coordinate[t.getPosition()];n[this.beFloatedAnimal.getId()]=t.getPosition(),this.removeLawn(t.getPosition()),egret.Tween.get(this.beFloatedAnimal).to({x:i[0],y:i[1]},100).call(function(){a.addPrevPlayChess(i[0],i[1]),a.isAnimalMoving=!1,a.beFloatedAnimal=null,a.moveDirection=[],a.changeCanPlayTeam(),a.removeArrows(),e&&e()}),AudioMgr.getInstance().sound_zou()},e.prototype.addLawn=function(t){var e=this.grid.coordinate[t],a=new Lawn(t);a.x=e[0],a.y=e[1],this.addChild(a),this.lawns[t]=a},e.prototype.removeLawn=function(t){var e=this.lawns[t];GlueUtils.RemoveChild(e),delete this.lawns[t]},e.prototype.floatAnimal=function(t){t.y-=15,this.beFloatedAnimal=t,this.getMoveDirection(t),this.addArrows(),AudioMgr.getInstance().sound_select()},e.prototype.floatAnimalCancel=function(){this.beFloatedAnimal.y+=15,this.beFloatedAnimal=null,this.moveDirection=[],this.removeArrows()},e.prototype.getMoveDirection=function(t){var e=this;this.moveDirection=[];var a=DataMgr.getInstance().userData.matchingData.chessData,n=Number(a[t.getId()].slice(0,1))-1+a[t.getId()].slice(1),i=Number(a[t.getId()].slice(0,1))+1+a[t.getId()].slice(1),s=a[t.getId()].slice(0,1)+(Number(a[t.getId()].slice(1))-1),o=a[t.getId()].slice(0,1)+(Number(a[t.getId()].slice(1))+1);Object.keys(this.animals).forEach(function(r,h){if(a[r]===s){var d=e.animals[r];d&&d.getIsOpen()&&d.getColor()!==t.getColor()&&e.moveDirection.push(Direction.UP)}else if(a[r]===o){var d=e.animals[r];d&&d.getIsOpen()&&d.getColor()!==t.getColor()&&e.moveDirection.push(Direction.DOWN)}else if(a[r]===n){var d=e.animals[r];d&&d.getIsOpen()&&d.getColor()!==t.getColor()&&e.moveDirection.push(Direction.LEFT)}else if(a[r]===i){var d=e.animals[r];d&&d.getIsOpen()&&d.getColor()!==t.getColor()&&e.moveDirection.push(Direction.RIGHT)}}),Object.keys(this.lawns).forEach(function(t,a){t===s?e.moveDirection.push(Direction.UP):t===o?e.moveDirection.push(Direction.DOWN):t===n?e.moveDirection.push(Direction.LEFT):t===i&&e.moveDirection.push(Direction.RIGHT)})},e.prototype.addArrows=function(){var t=this;this.isRobotModel||this.moveDirection.forEach(function(e,a){var n=new Arrow(e);n.x=t.beFloatedAnimal.x,n.y=t.beFloatedAnimal.y,t.addChild(n)})},e.prototype.removeArrows=function(){this.getChildByName(Direction.UP+"")&&this.removeChild(this.getChildByName(Direction.UP+"")),this.getChildByName(Direction.DOWN+"")&&this.removeChild(this.getChildByName(Direction.DOWN+"")),this.getChildByName(Direction.LEFT+"")&&this.removeChild(this.getChildByName(Direction.LEFT+"")),this.getChildByName(Direction.RIGHT+"")&&this.removeChild(this.getChildByName(Direction.RIGHT+""))},e.prototype.isSingleChess=function(){var t=0,e=0;return Object.keys(this.animals).forEach(function(a,n){"r"===a.slice(0,1)?t++:e++}),1===t||1===e?!0:void 0},e.prototype.changeCanPlayTeam=function(){"r"===this.canPlayTeam?this.canPlayTeam="b":this.canPlayTeam="r",this.changeTimeWarnImg(),this.changTimeWarnSec()},e.prototype.overGame=function(t){if(!this.isGameOver){this.isRobotModel&&Robot.getInstance().stopRamdonTimer(),this.removePrevPlayChess(),this.isGameOver=!0,clearInterval(this.timeWarnSecTimer),this.timeWarnSecTimer=null,wx.showToast({title:"游戏结束",icon:"none",duration:1500}),this.clickAllEggs();var a=setTimeout(function(){e.instance.addChild(new GameOverPage(t)),clearTimeout(a),a=null},2500);switch(t){case GameOverResult.WIN:Net.gameOverScore(1,DataMgr.getInstance().userData.uid,DataMgr.getInstance().userData.matchingData.enemyUserInfo.uid),AudioMgr.getInstance().sound_win();break;case GameOverResult.LOSE:Net.gameOverScore(-1,DataMgr.getInstance().userData.uid,DataMgr.getInstance().userData.matchingData.enemyUserInfo.uid),AudioMgr.getInstance().sound_lost();
break;case GameOverResult.TIE:Net.gameOverScore(0,DataMgr.getInstance().userData.uid,DataMgr.getInstance().userData.matchingData.enemyUserInfo.uid),AudioMgr.getInstance().sound_notice()}}},e.prototype.checkWhoIsWinner=function(){for(var t=!1,e=!1,a=0,n=Object.keys(this.animals);a<n.length;a++){var i=n[a];"r"===i.slice(0,1)&&(t=!0),"b"===i.slice(0,1)&&(e=!0)}return t&&!e?"r":!t&&e?"b":t||e?null:"tie"},e.prototype.clickAllEggs=function(){var t=this;_.forIn(this.animals,function(e,a){e.getIsOpen()===!1&&(t.eatLawnNumber=0,t.preEatLawnAniamlId=null,e.openEgg(!1))})},e.prototype.changeTimeWarnImg=function(){"r"===DataMgr.getInstance().userData.matchingData.myTeam&&this.canPlayTeam===DataMgr.getInstance().userData.matchingData.myTeam?this.timeWarnImg.texture=RES.getRes("game_json.redHHBit_png"):"b"===DataMgr.getInstance().userData.matchingData.myTeam&&this.canPlayTeam===DataMgr.getInstance().userData.matchingData.myTeam?(this.timeWarnImg.texture=RES.getRes("game_json.bluHHBit_png"),egret.Tween.get(this.timeWarnImg).to({rotation:180},0)):"r"===DataMgr.getInstance().userData.matchingData.enemyTeam&&this.canPlayTeam===DataMgr.getInstance().userData.matchingData.enemyTeam?(this.timeWarnImg.texture=RES.getRes("game_json.redHHBit_png"),egret.Tween.get(this.timeWarnImg).to({rotation:180},0)):"b"===DataMgr.getInstance().userData.matchingData.enemyTeam&&this.canPlayTeam===DataMgr.getInstance().userData.matchingData.enemyTeam&&(this.timeWarnImg.texture=RES.getRes("game_json.bluHHBit_png"))},e.prototype.changTimeWarnSec=function(){function t(){var t=this;if(this.timeWarnSec--,this.timeWarnSec<0&&(this.timeWarnSec=0),DataMgr.getInstance().userData.matchingData.myTeam===this.canPlayTeam)this.timeWarnSecText.text="我的回合 "+this.timeWarnSec+" S";else{var e=1===DataMgr.getInstance().userData.gender?"她":"他";this.timeWarnSecText.text=e+"的回合 "+this.timeWarnSec+" S"}if(this.timeWarnSec<10&&this.timeWarnSec%6===0&&DataMgr.getInstance().userData.matchingData.myTeam===this.canPlayTeam&&(AudioMgr.getInstance().sound_notice(),wx.showToast({title:"注意：剩余"+this.timeWarnSec+"秒,请尽快走棋!",icon:"none",duration:1500})),this.timeWarnSec<=0&&this.canPlayTeam===DataMgr.getInstance().userData.matchingData.myTeam?(wx.showToast({title:"时间到，判定为认输",icon:"none",duration:1500}),this.notice_Quit()):this.isRobotModel&&0===this.timeWarnSec&&this.canPlayTeam===DataMgr.getInstance().userData.matchingData.enemyTeam&&this.listen_Quit(),this.timeWarnSec<=0&&this.canPlayTeam===DataMgr.getInstance().userData.matchingData.enemyTeam&&!this.isGameOver)var a=setTimeout(function(){wx.showToast({title:"时间到，对方认输",icon:"none",duration:1500}),t.overGame(GameOverResult.WIN),clearTimeout(a),a=null},2e3)}clearInterval(this.timeWarnSecTimer),this.timeWarnSecTimer=null,DataMgr.getInstance().userData.matchingData.myTeam===this.canPlayTeam?this.timeWarnSecText.x=405:DataMgr.getInstance().userData.matchingData.enemyTeam===this.canPlayTeam&&(this.timeWarnSecText.x=345),this.timeWarnSec=24,t.call(this),this.timeWarnSecTimer=setInterval(t.bind(this),1e3)},e.prototype.notice_OpenEgg=function(t){if(!this.isRobotModel){var e=[{status:0}],a={};a.animal=t,e.push(a);var n={uid:DataMgr.getInstance().userData.uid,to_uid:DataMgr.getInstance().userData.matchingData.enemyUid,act:2,data:e};Socket.getInstance().sendMessage(n)}},e.prototype.listen_ClickEgg=function(t){var e=this;this.isGameOver||(this.isAnimalMoving=!0,this.removePrevPlayChess(),this.animals[t].openEgg(!0,function(){e.addPrevPlayChess(e.animals[t].x,e.animals[t].y),e.isAnimalMoving=!1,e.changeCanPlayTeam()}))},e.prototype.notice_MoveAnimal=function(t,e){if(!this.isRobotModel){var a=[{status:1}],n={};n.beFloatedAnimal=t,n.target=e,a.push(n);var i={uid:DataMgr.getInstance().userData.uid,to_uid:DataMgr.getInstance().userData.matchingData.enemyUid,act:2,data:a};Socket.getInstance().sendMessage(i)}},e.prototype.listen_MoveAnimal=function(t,e,a){this.isGameOver||(this.floatAnimal(this.animals[t]),a?this.eatOtherChess(this.animals[e]):this.eatLawn(this.lawns[e]))},e.prototype.notice_Peace=function(){var t=this;if(this.canPlayTeam!==DataMgr.getInstance().userData.matchingData.myTeam)return void wx.showToast({title:"等待对手走棋",icon:"none",duration:1500});if(this.requestPeaceNumber<=0)return void wx.showToast({title:"您的求和次数已经用完了",icon:"none",duration:2500});if(this.requestPeaceNumber--,wx.showToast({title:"已发送求和",icon:"success",duration:1500}),this.isRobotModel){setTimeout(function(){Robot.getInstance().robotNumberLess()?t.listen_ComfirePeace():t.listen_RefusePeace()},_.random(2e3,4e3))}else{var e=[{status:2}],a={uid:DataMgr.getInstance().userData.uid,to_uid:DataMgr.getInstance().userData.matchingData.enemyUserInfo.uid,act:2,data:e};Socket.getInstance().sendMessage(a)}},e.prototype.listen_Peace=function(){if(!this.isGameOver){var t=this;wx.showModal({title:"提示",content:"对方请求和棋",success:function(e){e.confirm?t.notice_ComfirePeace():e.cancel&&t.notice_RefusePeace()}})}},e.prototype.notice_ComfirePeace=function(){if(this.overGame(GameOverResult.TIE),!this.isRobotModel){var t=[{status:3}],e={uid:DataMgr.getInstance().userData.uid,to_uid:DataMgr.getInstance().userData.matchingData.enemyUserInfo.uid,act:2,data:t};Socket.getInstance().sendMessage(e)}},e.prototype.listen_ComfirePeace=function(){if(!this.isGameOver){var t=this;wx.showToast({title:"对方已确认和棋",icon:"success",duration:1500});var e=setTimeout(function(){t.overGame(GameOverResult.TIE),clearTimeout(e)},1500)}},e.prototype.notice_RefusePeace=function(){if(!this.isRobotModel){var t=[{status:4}],e={uid:DataMgr.getInstance().userData.uid,to_uid:DataMgr.getInstance().userData.matchingData.enemyUserInfo.uid,act:2,data:t};Socket.getInstance().sendMessage(e)}},e.prototype.listen_RefusePeace=function(){this.isGameOver||wx.showToast({title:"对方拒绝和",icon:"none",duration:2e3})},e.prototype.notice_Quit=function(){if(this.overGame(GameOverResult.LOSE),!this.isRobotModel){var t=[{status:5}],e={uid:DataMgr.getInstance().userData.uid,to_uid:DataMgr.getInstance().userData.matchingData.enemyUserInfo.uid,act:2,data:t};Socket.getInstance().sendMessage(e)}},e.prototype.listen_Quit=function(){if(!this.isGameOver){var t=this;wx.showToast({title:"  对方已认输  ",icon:"success",duration:1200});var e=setTimeout(function(){t.overGame(GameOverResult.WIN),clearTimeout(e)},1200)}},e.prototype.listen_OffLine=function(){if(!(this.isGameOver||GameOverPage.instance&&GameOverPage.instance.parent)){var t=this;wx.showToast({title:"对方已下线",icon:"success",duration:2e3});var e=setTimeout(function(){t.overGame(GameOverResult.WIN),clearTimeout(e)},2e3)}},e.prototype.listen_Offline=function(){wx.showToast({title:"您已断线",icon:"none",duration:2e3}),this.isGameOver||this.overGame(GameOverResult.LOSE)},e.prototype.notice_Emoj=function(t){if(!this.isRobotModel){var e=[{status:7,emojNumber:t}],a={uid:DataMgr.getInstance().userData.uid,to_uid:DataMgr.getInstance().userData.matchingData.enemyUserInfo.uid,act:2,data:e};Socket.getInstance().sendMessage(a)}},e.prototype.listen_Emoj=function(t){function e(t){var e=new egret.Bitmap(t);e.width=60,e.height=60,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.x=594,e.y=122*Main.K_H,this.addChild(e),egret.Tween.get(e).to({x:e.x-_.random(0,200),y:e.y+_.random(180,220)},1e3,egret.Ease.sineIn).to({alpha:0},200)}if(!this.isGameOver)switch(t){case 1:e.call(this,this.emoj1.texture);break;case 2:e.call(this,this.emoj2.texture);break;case 3:e.call(this,this.emoj3.texture);break;case 4:e.call(this,this.emoj4.texture)}},e.prototype.listen_TextMsg=function(t){DataMgr.getInstance().tempData.msgText.push(["r"===DataMgr.getInstance().userData.matchingData.myTeam?"b":"r","对方："+t]),this.updateTextMsg(),Dialog.instance&&Dialog.instance.parent&&Dialog.instance.resetContent()},e.prototype.notice_TangleLose=function(){if(!this.isRobotModel){var t=[{status:9}],e={uid:DataMgr.getInstance().userData.uid,to_uid:DataMgr.getInstance().userData.matchingData.enemyUserInfo.uid,act:2,data:t};Socket.getInstance().sendMessage(e)}},e.prototype.listen_TangleLose=function(){this.isGameOver||(this.overGame(GameOverResult.WIN),wx.showToast({title:"对方因穷追不舍被判定为负",icon:"none",duration:3500}))},e.prototype.notice_TangleTie=function(){if(!this.isRobotModel){var t=[{status:10}],e={uid:DataMgr.getInstance().userData.uid,to_uid:DataMgr.getInstance().userData.matchingData.enemyUserInfo.uid,act:2,data:t};Socket.getInstance().sendMessage(e)}},e.prototype.listen_TangleTie=function(){this.isGameOver||(this.overGame(GameOverResult.TIE),wx.showToast({title:"长期吃不到棋判定为和棋",icon:"none",duration:3500}))},e.prototype.getRobotModal=function(){return this.isRobotModel},e.prototype.getCanPlayTeam=function(){return this.canPlayTeam},e}(egret.DisplayObjectContainer);__reflect(GamePage.prototype,"GamePage");var BaseUtils=function(){function t(){}return t.getRomNumberBetween=function(t,e){return parseInt(Math.random()*(t-e)+e+"",10)},t.deleteArrayItem=function(t,e){var a=t.indexOf(e);a>-1&&t.splice(a,1)},t}();__reflect(BaseUtils.prototype,"BaseUtils");var GlueUtils=function(){function t(){}return t.appUpdate=function(){if("function"==typeof wx.getUpdateManager){var t=wx.getUpdateManager();t.onCheckForUpdate(function(t){console.log("请求完新版本信息的回调结果",t)}),t.onUpdateReady(function(){t.applyUpdate()}),t.onUpdateFailed(function(){})}},t.RemoveChild=function(t){t&&t.parent&&(t instanceof egret.DisplayObjectContainer&&t.removeChildren(),t.parent.removeChild(t),t=null)},t.removedListener=function(t,e,a,n){t.once(egret.Event.REMOVED_FROM_STAGE,function(){t.removeEventListener(e,a,n)},n)},t.createBitmapByName=function(t){return new egret.Bitmap(RES.getRes(t))},t.createImg=function(t,e,a,n,i){var s=new egret.Bitmap(RES.getRes(t));return s.width=e,s.height=a,s.anchorOffsetX=s.width/2,s.anchorOffsetY=s.height/2,s.x=n,s.y=i,s},t.createIcon=function(e){var a=t.createBitmapByName(e.url);return a.width=e.width,a.height=e.height,a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,a.x=e.x,a.y=e.y,a},t.createBitmapByUrl=function(t){var e=this;return new Promise(function(a,n){RES.getResByUrl(t,function(t){var e=new egret.Bitmap;e.texture=t,e.width=100,e.height=100,e.x=100,e.y=100,a(e)},e,RES.ResourceItem.TYPE_IMAGE)})},t.rectToCircle=function(t){t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2;var e=new egret.Shape;e.graphics.beginFill(255),e.graphics.drawCircle(t.x,t.y,t.width/2),e.graphics.endFill(),t.parent.addChild(e),t.mask=e},t.creatButton=function(t){return new Button(t)},t}();__reflect(GlueUtils.prototype,"GlueUtils");var Pool=function(){function t(){}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.getPoolBySign=function(t){return this[t]||(this[t]=[])},t.prototype.getItemByClass=function(t,e){var a=this.getPoolBySign(t),n=a.length?a.shift():new e;return n},t.prototype.recover=function(t,e){this.getPoolBySign(t).push(e)},t}();__reflect(Pool.prototype,"Pool");var AudioMgr=function(){function t(){}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.sound_chi=function(){if(DataMgr.getInstance().userData.musicIsOpen){var t=RES.getRes("chi_mp3");t.play(0,1)}},t.prototype.sound_dongwu=function(t){if(DataMgr.getInstance().userData.musicIsOpen){var e;switch(t){case 1:e=RES.getRes("dongwu_1_mp3"),e.play(0,1);break;case 2:e=RES.getRes("dongwu_2_mp3"),e.play(0,1);break;case 3:e=RES.getRes("dongwu_3_mp3"),e.play(0,1);break;case 4:e=RES.getRes("dongwu_4_mp3"),e.play(0,1);break;case 5:e=RES.getRes("dongwu_5_mp3"),e.play(0,1);break;case 6:e=RES.getRes("dongwu_6_mp3"),e.play(0,1);break;case 7:e=RES.getRes("dongwu_7_mp3"),e.play(0,1);break;case 8:e=RES.getRes("dongwu_8_mp3"),e.play(0,1)}}},t.prototype.sound_fail=function(){if(DataMgr.getInstance().userData.musicIsOpen){var t=RES.getRes("fail_mp3");t.play(0,1)}},t.prototype.sound_fan=function(){if(DataMgr.getInstance().userData.musicIsOpen){var t=RES.getRes("fan_mp3");t.play(0,1)}},t.prototype.sound_lost=function(){if(DataMgr.getInstance().userData.musicIsOpen){var t=RES.getRes("lost_mp3");t.play(0,1)}},t.prototype.sound_notice=function(){if(DataMgr.getInstance().userData.musicIsOpen){var t=RES.getRes("notice_mp3");t.play(0,1)}},t.prototype.sound_pipei=function(){if(DataMgr.getInstance().userData.musicIsOpen){var t=RES.getRes("pipei_mp3");t.play(0,1)}},t.prototype.sound_select=function(){if(DataMgr.getInstance().userData.musicIsOpen){var t=RES.getRes("select_mp3");t.play(0,1)}},t.prototype.sound_Success=function(){if(DataMgr.getInstance().userData.musicIsOpen){var t=RES.getRes("Success_mp3");t.play(0,1)}},t.prototype.sound_win=function(){if(DataMgr.getInstance().userData.musicIsOpen){var t=RES.getRes("win_mp3");t.play(0,1)}},t.prototype.sound_zha=function(){if(DataMgr.getInstance().userData.musicIsOpen){var t=RES.getRes("zha_mp3");t.play(0,1)}},t.prototype.sound_zou=function(){if(DataMgr.getInstance().userData.musicIsOpen){var t=RES.getRes("zou_mp3");t.play(0,1)}},t.prototype.btnClick=function(){if(DataMgr.getInstance().userData.musicIsOpen){var t=RES.getRes("btnClick_mp3");t.play(0,1)}},t.prototype.userSkin=function(){if(DataMgr.getInstance().userData.musicIsOpen){var t=RES.getRes("userSkin_mp3");t.play(0,1)}},t.prototype.showAward=function(){if(DataMgr.getInstance().userData.musicIsOpen){var t=RES.getRes("showAward_mp3");t.play(0,1)}},t.prototype.turnPlate=function(){if(DataMgr.getInstance().userData.musicIsOpen){var t=RES.getRes("turnPlate_mp3");t.play(0,1)}},t}();__reflect(AudioMgr.prototype,"AudioMgr");var BusUtils=function(){function t(){}return t.getEntranceCostNumber=function(t){return DataMgr.getInstance().gameData_CF.PLAY_COST_BASE+t},t.getLevelByStar=function(){var t=DataMgr.getInstance().userData.totalStar;return t>=6+6*(DataMgr.getInstance().gameData_LG.levelTitle.length-3)?DataMgr.getInstance().gameData_LG.levelTitle.length-1:2>t?0:t>=2&&6>t?1:2+Math.floor((t-6)/6)},t.getStarNumByLevel=function(t){var e=DataMgr.getInstance().userData.totalStar;return 0===t?e:1===t?e-2:t===DataMgr.getInstance().gameData_LG.levelTitle.length-1?e-2-4-6*(t-2):(e-6)%6},t}();__reflect(BusUtils.prototype,"BusUtils");var DataEvent;!function(t){t[t.SEND_TEXT_MSG=0]="SEND_TEXT_MSG",t[t.HIDE_PRE_DIALOG=1]="HIDE_PRE_DIALOG"}(DataEvent||(DataEvent={}));var DataMgr=function(){function t(){this.EventList=[],this.gameData_CF={VERSION:"v1.0.9",XID:79,HOST:"https://www.eryieryi.top",SOCKET_HOST:"wss://upload.eryieryi.top",NEEDAUTH:!0,PLAY_COST_BASE:10},this.gameData_LG={isLogined:!1,isAudit:1,showGameClub:!1,shareInfo:{title:"跟我一起玩斗兽棋吧",url:"http://img1.imgtn.bdimg.com/it/u=1855338219,1671092062&fm=26&gp=0.jpg"},banner:["adunit-226c37d220f8bf0e","adunit-c04d1e67a2ae18d2"],levelTitle:["萌新原木","顽强青铜","坚韧黑铁I","坚韧黑铁II","傲气白银I","傲气白银II","傲气白银III","不屈黄金I","不屈黄金II","不屈黄金III","荣耀铂金I","荣耀铂金II","荣耀铂金III","荣耀铂金IV","永恒钻石I","永恒钻石II","永恒钻石III","永恒钻石IV","至尊星耀I","至尊星耀II","至尊星耀III","至尊星耀IV","非凡大师I","非凡大师II","非凡大师III","非凡大师IV","非凡大师V","最强王者"]},this.gameData_UI={},this.userData={avatarUrl:null,city:null,country:null,gender:null,language:null,nickName:null,province:null,openId:null,isAuth:0,uid:null,musicIsOpen:!0,totalStar:1,gameProps:{reviveCard:0,mouseCard:0,countCard:0},coin:50,signIn:!1,signInNumber:0,inviteFriendsStatus:[{status:0,avatar:null,giftNumber:80},{status:0,avatar:null,giftNumber:90},{status:0,avatar:null,giftNumber:100},{status:0,avatar:null,giftNumber:110},{status:0,avatar:null,giftNumber:150},{status:0,avatar:null,giftNumber:80},{status:0,avatar:null,giftNumber:90},{status:0,avatar:null,giftNumber:100},{status:0,avatar:null,giftNumber:110},{status:0,avatar:null,giftNumber:200}],shareTurnNumber:2,clickADDiamondNumber:0,matchingData:null},this.tempData={msgText:[],gameLevel:null}}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.dispatchEvent=function(t,e){var a=this.EventList[t];if(!a||0===a.length)return!1;for(var n=0,i=void 0;i=a[n++];)i.call(this,e)},t.prototype.addEventListener=function(t,e){this.EventList[t]||(this.EventList[t]=[]),this.EventList[t].push(e)},t.prototype.removeEventListener=function(t,e){var a=this.EventList[t];if(!a)return!1;if(e)for(var n=a.length-1;n>=0;n--){var i=a[n];i===e&&a.splice(n,1)}else a&&(a.length=0)},t.prototype.removeAllEventListener=function(){this.EventList=[]},t}();__reflect(DataMgr.prototype,"DataMgr");var GameStatus;!function(t){t[t.PLAYING=0]="PLAYING",t[t.GAME_OVER=1]="GAME_OVER",t[t.LEAVE_ROOM=2]="LEAVE_ROOM"}(GameStatus||(GameStatus={}));var Direction;!function(t){t[t.UP=0]="UP",t[t.DOWN=1]="DOWN",t[t.LEFT=2]="LEFT",t[t.RIGHT=3]="RIGHT"}(Direction||(Direction={}));var GameOverResult;!function(t){t[t.WIN=0]="WIN",t[t.LOSE=1]="LOSE",t[t.TIE=2]="TIE"}(GameOverResult||(GameOverResult={}));var LoadingUI_Index=function(t){function e(){var a=t.call(this)||this;return a.addEventListener(egret.Event.ADDED_TO_STAGE,function(t){a.init()},a),a.once(egret.Event.REMOVED_FROM_STAGE,function(t){e.instance=null},a),a}return __extends(e,t),e.prototype.init=function(){e.instance=this,this.addProcessBg(),this.addProgressingImg(),this.addMusicIcon()},e.prototype.addProcessBg=function(){var t=GlueUtils.createBitmapByName("loadingBg_jpg");t.scale9Grid=new egret.Rectangle(0,1330,750,1334),t.width=Main.StageWidth,t.height=Main.StageHeight,this.addChild(t);var e=GlueUtils.createBitmapByName("loading2_png");e.scale9Grid=new egret.Rectangle(15,15,0,0),e.width=.7*Main.StageWidth,e.x=112,e.y=700,this.addChild(e)},e.prototype.addProgressingImg=function(){this.progressingImg=GlueUtils.createBitmapByName("loading1_png"),this.progressingImg.scale9Grid=new egret.Rectangle(15,15,0,0),this.progressingImg.width=0,this.progressingImg.x=114,this.progressingImg.y=700,this.addChild(this.progressingImg),this.textField=new egret.TextField,this.textField.width=Main.StageWidth,this.textField.y=706,this.textField.textAlign=egret.HorizontalAlign.CENTER,this.textField.textColor=16777215,this.textField.size=30,this.addChild(this.textField)},e.prototype.addMusicIcon=function(){this.musicIcon=GlueUtils.createBitmapByName("musicIcon_png"),this.musicIcon.width=50,this.musicIcon.height=62,this.musicIcon.x=112,this.musicIcon.y=684,this.addChild(this.musicIcon)},e.prototype.addTips=function(){var t=new egret.TextField;t.width=Main.StageWidth,t.y=640,t.textAlign=egret.HorizontalAlign.CENTER,t.textColor=16777215,t.size=32,t.text="戴上耳机获取最佳体验",this.addChild(t)},e.prototype.onProgress=function(t,a){this.progressingImg.width=t/a*510,this.textField.text=t+"/"+a,this.musicIcon.x=92+t/a*510,t===a&&GlueUtils.RemoveChild(e.instance)},e}(egret.Sprite);__reflect(LoadingUI_Index.prototype,"LoadingUI_Index",["RES.PromiseTaskReporter"]);var LoadingUI_Normal=function(t){function e(){var a=t.call(this)||this;return a.addEventListener(egret.Event.ADDED_TO_STAGE,function(t){a.init()},a),a.once(egret.Event.REMOVED_FROM_STAGE,function(t){e.instance=null},a),a}return __extends(e,t),e.prototype.init=function(){e.instance=this,this.progressingImg=GlueUtils.createBitmapByName("loadingCircle_png"),this.progressingImg.width=150,this.progressingImg.height=150,this.progressingImg.anchorOffsetX=.5*this.progressingImg.width,this.progressingImg.anchorOffsetY=.5*this.progressingImg.height,this.progressingImg.x=.5*Main.StageWidth,this.progressingImg.y=.5*Main.StageHeight,this.addChild(this.progressingImg),this.textField=new egret.TextField,this.textField.width=Main.StageWidth,this.textField.y=.5*Main.StageHeight-15,this.textField.textAlign=egret.HorizontalAlign.CENTER,this.textField.textColor=16777215,this.textField.size=30,this.addChild(this.textField)},e.prototype.onProgress=function(t,a){this.progressingImg.rotation+=6,this.textField.text=t+"/"+a,t===a&&GlueUtils.RemoveChild(e.instance)},e}(egret.Sprite);__reflect(LoadingUI_Normal.prototype,"LoadingUI_Normal",["RES.PromiseTaskReporter"]);var Mask=function(t){function e(e,a,n,i,s){void 0===e&&(e=.8),void 0===a&&(a=0),void 0===n&&(n=0),void 0===i&&(i=Main.StageWidth),void 0===s&&(s=Main.StageHeight);var o=t.call(this)||this;return o.graphics.beginFill(0,e),o.graphics.drawRect(a,n,i,s),o.graphics.endFill(),o.touchEnabled=!0,o}return __extends(e,t),e}(egret.Shape);__reflect(Mask.prototype,"Mask");var Net=function(){function t(){}return t.request=function(t,e,a,n,i,s){function o(t){return"function"==typeof t}void 0===e&&(e="GET"),e=e.toUpperCase();var r="POST"===e?"application/x-www-form-urlencoded":"application/json";wx.request({url:DataMgr.getInstance().gameData_CF.HOST+t,data:a,dataType:"json",method:e,header:{"Content-Type":r},success:function(t){200==t.statusCode?o(n)&&n(t.data):o(i)&&i()},fail:function(t){console.error("网络请求error",t),o(i)&&i()},complete:function(){o(s)&&s()}})},t.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e,a){wx.login({success:function(n){t.request("/animal/Apilogin/codeLogin","POST",{xid:DataMgr.getInstance().gameData_CF.XID,code:n.code},function(t){e(t)},function(t){a(t)})}})})]})})},t.storeUserInfo=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(a){return[2,new Promise(function(a,n){t.request("/animal/Apilogin/userLogin","POST",{xid:DataMgr.getInstance().gameData_CF.XID,uid:DataMgr.getInstance().userData.uid,userinfo:JSON.stringify(e)},function(t){a(t)},function(t){n(t)})})]})})},t.getWXUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,new Promise(function(t,e){wx.getUserInfo({success:function(e){t(e)},fail:function(t){e(t)}})})]})})},t.creatLoginBtn=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e,a){var n=wx.createUserInfoButton({type:"image",image:"resource/images/platform/loginGame.png",style:{width:window.innerWidth,height:window.innerHeight,left:0*window.innerWidth,top:0*window.innerHeight}});n.onTap(function(a){a.userInfo?(wx.showToast({title:"登录成功",icon:"none",duration:2e3}),n.destroy(),t.storeUserInfo(a.userInfo),e(a)):wx.showToast({title:"登录失败，请重新再试",icon:"none",duration:2e3})})})]})})},t.signIn=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t=this,[2,new Promise(function(e,a){t.request("/animal/Apilogin/setSignInfo","POST",{xid:DataMgr.getInstance().gameData_CF.XID,uid:DataMgr.getInstance().userData.uid},function(t){e(t)},function(t){a(t)})})]})})},t.changeInviteFriendsData=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(a){return e=this,[2,new Promise(function(a,n){e.request("/animal/Apilogin/saveInviteData","POST",{xid:DataMgr.getInstance().gameData_CF.XID,uid:DataMgr.getInstance().userData.uid,jid:t},function(t){a(t)},function(t){n(t)})})]})})},t.storeInviteFriendsData=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){return t=this,[2,new Promise(function(e,a){t.request("/animal/Apilogin/saveInviteInfo","POST",{xid:DataMgr.getInstance().gameData_CF.XID,uid:DataMgr.getInstance().userData.uid,invite_info:JSON.stringify(DataMgr.getInstance().userData.inviteFriendsStatus)},function(t){e(t)},function(t){a(t)})})]})})},t.reduceShareTurnNumber=function(){var t=this;return new Promise(function(e,a){t.request("/animal/Apilogin/chageShare","POST",{xid:DataMgr.getInstance().gameData_CF.XID,uid:DataMgr.getInstance().userData.uid},function(t){e(t)},function(t){a(t)})})},t.reduceClickADDiamondNumber=function(){var t=this;return new Promise(function(e,a){t.request("/animal/Apilogin/chickDiamond","POST",{xid:DataMgr.getInstance().gameData_CF.XID,uid:DataMgr.getInstance().userData.uid},function(t){e(t)},function(t){a(t)})})},t.gameOverScore=function(e,a,n){return new Promise(function(a,i){t.request("/animal/Apiplay/viaPass","POST",{xid:DataMgr.getInstance().gameData_CF.XID,is_win:e,uid:DataMgr.getInstance().userData.uid,to_uid:n},function(t){a(t)},function(t){i(t)})})},t.getGlobalRankData=function(e){return wx.showLoading({title:"加载中.."}),new Promise(function(e,a){t.request("/animal/Apiplay/allRank","POST",{xid:DataMgr.getInstance().gameData_CF.XID,uid:DataMgr.getInstance().userData.uid},function(t){e(t)},function(t){a(t)},function(t){wx.hideLoading()})})},t.getRototUid=function(){return new Promise(function(e,a){t.request("/animal/Apiplay/getRandUser","POST",{xid:DataMgr.getInstance().gameData_CF.XID,uid:DataMgr.getInstance().userData.uid},function(t){e(t)},function(t){a(t)})})},t.storeUserGameInfo=function(e){return new Promise(function(a,n){t.request("/animal/Apilogin/saveUserInfo","POST",{xid:DataMgr.getInstance().gameData_CF.XID,uid:DataMgr.getInstance().userData.uid,saveUserInfo:JSON.stringify(e)},function(t){a(t)},function(t){n(t)})})},t.getUserPlayInfo=function(){return new Promise(function(e,a){t.request("/animal/Apilogin/returnMyResult","POST",{xid:DataMgr.getInstance().gameData_CF.XID,uid:DataMgr.getInstance().userData.uid},function(t){e(t)},function(t){a(t)})})},t}();__reflect(Net.prototype,"Net");var SocketStatus;!function(t){t[t.CONNECTING=0]="CONNECTING",t[t.OPEN=1]="OPEN",t[t.CLOSING=2]="CLOSING",t[t.CLOSED=3]="CLOSED"}(SocketStatus||(SocketStatus={}));var SocketEvent;!function(t){t[t.connecting=0]="connecting",t[t.active=1]="active",t[t.closing=2]="closing",t[t.closed=3]="closed",t[t.error=4]="error",t[t.message=5]="message"}(SocketEvent||(SocketEvent={}));var Socket=function(){function t(){this.EventList=[],this.socketTask=null}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.addSocketListener=function(){var t=this;this.socketTask.onOpen(function(e){console.info("监听到信道已打开"),t.dispatchEvent(SocketEvent.active,e)}),this.socketTask.onClose(function(e){t.dispatchEvent(SocketEvent.closed,e),t.removeAllEventListener(),t.socketTask=null,console.info("监听到信道已关闭",e.code),1e3!==e.code&&(console.warn("该信道非正常关闭",e),wx.showToast({title:"网络断开链接",icon:"none",duration:4e3}))}),this.socketTask.onError(function(e){t.dispatchEvent(SocketEvent.error,e),wx.showToast({title:"网络错误",icon:"loading",duration:3e3}),t.removeAllEventListener(),t.socketTask=null}),this.socketTask.onMessage(function(e){var a=JSON.parse(e.data);9!==a.act&&console.info("接收到消息：",a),t.dispatchEvent(SocketEvent.message,a)})},t.prototype.openTunnel=function(t,e){var a=this,n=this;return e?this.socketUrl=DataMgr.getInstance().gameData_CF.SOCKET_HOST+"/wss?uid="+DataMgr.getInstance().userData.uid+"&act="+t+"&to_uid="+e:this.socketUrl=DataMgr.getInstance().gameData_CF.SOCKET_HOST+"/wss?uid="+DataMgr.getInstance().userData.uid+"&act="+t+"&totalStar="+DataMgr.getInstance().userData.totalStar,new Promise(function(t,e){if(a.socketTask){console.error("请关闭已存在的websocket链接"),wx.showToast({title:"网络错误，请重启",icon:"none",duration:3e3});var i=setTimeout(function(){wx.exitMiniProgram({}),clearTimeout(i),i=null},3e3)}else a.socketTask=wx.connectSocket({url:n.socketUrl,method:"GET",success:function(e){n.dispatchEvent(SocketEvent.connecting,e),t()},fail:function(t){e()}})})},t.prototype.closeTunnel=function(){var t=this;return new Promise(function(e,a){t.socketTask&&t.socketTask.readyState===SocketStatus.OPEN?(t.dispatchEvent(SocketEvent.closing),t.socketTask.close({code:1e3,reason:"主动断开信道"}),console.info("开始主动关闭信道"),e()):(console.warn("当前信道未在连接状态，强行清空监听和socketTask"),t.removeAllEventListener(),t.socketTask=null,a())})},t.prototype.sendMessage=function(t){var e=this;return new Promise(function(a,n){return e.socketTask?void e.socketTask.send({data:JSON.stringify(t),success:function(t){a()},fail:function(t){this.dispatchEvent(SocketEvent.error,{message:"数据发送失败"}),this.socketTask.readyState!==SocketStatus.OPEN?wx.showToast({title:"当前网络未连接/已断开",icon:"none",duration:3e3}):wx.showToast({title:"消息发送失败，您可能已断线",icon:"none",duration:3e3}),this.removeAllEventListener(),this.socketTask=null,n()}}):(wx.showToast({title:"当前网络未连接/已断开",icon:"none",duration:3e3}),e.removeAllEventListener(),void(e.socketTask=null))})},t.prototype.dispatchEvent=function(t,e){var a=this.EventList[t];if(!a||0===a.length)return!1;for(var n=0,i=void 0;i=a[n++];)i.call(this,e)},t.prototype.addEventListener=function(t,e){this.EventList[t]||(this.EventList[t]=[]),this.EventList[t].push(e)},t.prototype.removeEventListener=function(t,e){var a=this.EventList[t];if(!a)return!1;if(e)for(var n=a.length-1;n>=0;n--){var i=a[n];i===e&&a.splice(n,1)}else a&&(a.length=0)},t.prototype.removeAllEventListener=function(){this.EventList=[]},t}();__reflect(Socket.prototype,"Socket");var Button=function(t){function e(e){var a=t.call(this)||this;return a.options=e,a.once(egret.Event.ADDED_TO_STAGE,function(t){a.width=a.options.width,a.height=a.options.height,a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,a.x=a.options.x,a.y=a.options.y,a.bg=GlueUtils.createBitmapByName(a.options.url),a.bg.width=a.options.width,a.bg.height=a.options.height,a.bg.anchorOffsetX=a.bg.width/2,a.bg.anchorOffsetY=a.bg.height/2,a.bg.x=a.width/2,a.bg.y=a.height/2,a.addChild(a.bg),a.onClick()},a),a.once(egret.Event.REMOVED_FROM_STAGE,function(t){a.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,a.expand,a),a.removeEventListener(egret.TouchEvent.TOUCH_TAP,a.shrinkWithCb,a),a.parent.touchEnabled=!1,a.parent.removeEventListener(egret.TouchEvent.TOUCH_MOVE,a.shrink,a)},a),a}return __extends(e,t),e.prototype.onClick=function(){this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.expand,this),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.shrinkWithCb,this)},e.prototype.expand=function(){var t=this;egret.Tween.get(this.bg).to({scaleX:this.options.scale?this.options.scale:.95,scaleY:this.options.scale?this.options.scale:.95},50,egret.Ease.sineInOut).call(function(){t.bg.filters=t.options.filter?t.options.filter:[new egret.DropShadowFilter(10,45,0,.8,16,16,.8,1,!1,!1)]}),this.parent.touchEnabled=!0,this.parent.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.shrink,this)},e.prototype.shrink=function(t){var e=this,a=t.stageX,n=t.stageY;this.hitTestPoint(a,n)||(egret.Tween.get(this.bg).to({scaleX:1,scaleY:1},50,egret.Ease.sineInOut).call(function(){e.bg.filters=[]}),this.parent.touchEnabled=!1,this.parent.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.shrink,this))},e.prototype.shrinkWithCb=function(){var t=this;egret.Tween.get(this.bg).to({scaleX:1,scaleY:1},50,egret.Ease.sineInOut).call(function(){if(t.bg.filters=[],t.options.callBack){if(AudioMgr.getInstance().btnClick(),0===DataMgr.getInstance().userData.isAuth)return void wx.showToast({title:"请先授权",icon:"none",duration:2e3});t.options.callBack()}})},e.prototype.changeBg=function(t){this.bg.texture=t},e}(egret.DisplayObjectContainer);__reflect(Button.prototype,"Button");var Modal=function(t){function e(a,n){void 0===n&&(n=e.STATUS.LEFT_INT);var i=t.call(this)||this;switch(i.addMask(),n){case 0:i.leftToRight(a);break;case 1:i.centerLargen(a)}return i}return __extends(e,t),e.prototype.addMask=function(){var t=new Mask(.4);this.addChild(t)},e.prototype.leftToRight=function(t){t.x=-t.width,t.y=(Main.StageHeight-t.height)/2,this.addChild(t),egret.Tween.get(t).to({x:(Main.StageWidth-t.width)/2+6},500,egret.Ease.sineInOut).call(function(){egret.Tween.get(t).to({x:(Main.StageWidth-t.width)/2},20)})},e.prototype.centerLargen=function(t){var e=t.width,a=t.height;t.width=0,t.height=0,t.x=(Main.StageWidth-t.width)/2,t.y=(Main.StageHeight-t.height)/2,this.addChild(t),egret.Tween.get(t).to({width:e+20},500,egret.Ease.sineInOut).call(function(){egret.Tween.get(t).to({x:a},20)})},e.STATUS={LEFT_INT:0,CENTER_INT:1},e}(egret.DisplayObjectContainer);__reflect(Modal.prototype,"Modal");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(a){switch(a.label){case 0:return console.info("当前的版本为："+DataMgr.getInstance().gameData_CF.VERSION),this.stage.maxTouches=1,wx.setPreferredFramesPerSecond(30),GlueUtils.appUpdate(),wx.showShareMenu({withShareTicket:!0}),wx.onShow(function(a){if(console.log("opt.query",a.query),t.options=a,t.addDiamondForInvitor(),!Socket.getInstance().socketTask&&(MatchPage.instance&&MatchPage.instance.parent||MatchFriendPage.instance&&MatchFriendPage.instance.parent)){wx.showToast({title:"匹配断开",icon:"none",duration:3e3});
var n=setTimeout(function(){MatchPage.instance?GlueUtils.RemoveChild(MatchPage.instance):MatchFriendPage.instance&&GlueUtils.RemoveChild(MatchFriendPage.instance),e.Stage.addChild(new IndexPage),clearTimeout(n),n=null},2e3)}t.options.query.FriendsFight&&DataMgr.getInstance().userData.nickName&&DataMgr.getInstance().gameData_LG.isLogined&&(e.Stage.removeChildren(),e.Stage.addChild(new MatchFriendPage(Number(t.options.query.uid))))}),e.Stage=this.stage,e.StageWidth=this.stage.stageWidth,e.StageHeight=this.stage.stageHeight,e.K_H=this.stage.stageHeight/1334,e.BaseLine=e.StageHeight/2,[4,AssetsLoadMgr.loadLoadingGroup()];case 1:return a.sent(),[4,AssetsLoadMgr.loadGroup("IndexPage")];case 2:return a.sent(),e.Stage.addChild(new IndexPage),this.dataInit(),[2]}})})},e.prototype.dataInit=function(){var t=this;wx.showLoading({title:"登录中..",mask:!0}),Net.login().then(function(a){wx.hideLoading(),DataMgr.getInstance().gameData_LG={isLogined:!0,isAudit:void 0!==a.data.isAudit?a.data.isAudit:DataMgr.getInstance().gameData_LG.isAudit,showGameClub:void 0!==a.data.showGameClub?a.data.showGameClub:DataMgr.getInstance().gameData_LG.showGameClub,shareInfo:void 0!==a.data.shareInfo?a.data.shareInfo:DataMgr.getInstance().gameData_LG.shareInfo,banner:void 0!==a.data.banner?a.data.banner:DataMgr.getInstance().gameData_LG.banner,levelTitle:void 0!==a.data.levelTitle?a.data.levelTitle:DataMgr.getInstance().gameData_LG.levelTitle},DataMgr.getInstance().gameData_UI={},DataMgr.getInstance().userData={avatarUrl:DataMgr.getInstance().userData.avatarUrl,city:DataMgr.getInstance().userData.city,country:DataMgr.getInstance().userData.country,gender:DataMgr.getInstance().userData.gender,language:DataMgr.getInstance().userData.language,nickName:DataMgr.getInstance().userData.nickName,province:DataMgr.getInstance().userData.province,openId:void 0!==a.data.openid?a.data.openid:DataMgr.getInstance().userData.openId,isAuth:void 0!==a.data.is_auth?a.data.is_auth:DataMgr.getInstance().userData.isAuth,uid:void 0!==a.data.uid?String(a.data.uid):DataMgr.getInstance().userData.uid,musicIsOpen:DataMgr.getInstance().userData.musicIsOpen,totalStar:void 0!==a.data.userdata.totalStar?a.data.userdata.totalStar:DataMgr.getInstance().userData.totalStar,gameProps:void 0!==a.data.userdata.gameProps?JSON.parse(a.data.userdata.gameProps):DataMgr.getInstance().userData.gameProps,coin:void 0!==a.data.userdata.coin?a.data.userdata.coin:DataMgr.getInstance().userData.coin,signIn:void 0!==a.data.userdata.is_sign?1===a.data.userdata.is_sign?!0:!1:DataMgr.getInstance().userData.signIn,signInNumber:void 0!==a.data.userdata.sign_num?a.data.userdata.sign_num:DataMgr.getInstance().userData.signInNumber,inviteFriendsStatus:void 0!==a.data.userdata.invite_info?JSON.parse(a.data.userdata.invite_info):DataMgr.getInstance().userData.inviteFriendsStatus,shareTurnNumber:void 0!==a.data.userdata.shareTurnNumber?a.data.userdata.shareTurnNumber:DataMgr.getInstance().userData.shareTurnNumber,clickADDiamondNumber:void 0!==a.data.userdata.clickADDiamondNumber?a.data.userdata.clickADDiamondNumber:DataMgr.getInstance().userData.clickADDiamondNumber,matchingData:null},t.addTimerSaveUserGameInfo(),IndexPage.instance&&IndexPage.instance.updateIndexPageData(),DataMgr.getInstance().gameData_CF.NEEDAUTH&&1!==DataMgr.getInstance().userData.isAuth&&IndexPage.instance?Net.creatLoginBtn().then(function(a){DataMgr.getInstance().userData.isAuth=1,Object.assign(DataMgr.getInstance().userData,a.userInfo),t.options.query.FriendsFight&&(e.Stage.removeChildren(),e.Stage.addChild(new MatchFriendPage(Number(t.options.query.uid))))}):Net.getWXUserInfo().then(function(a){Object.assign(DataMgr.getInstance().userData,a.userInfo),t.options.query.FriendsFight&&(e.Stage.removeChildren(),e.Stage.addChild(new MatchFriendPage(Number(t.options.query.uid))))},function(t){console.error(t),e.Stage.addChild(new Toast("获取用户基本信息失败,请重试"))}),t.addDiamondForInvitor(),DataMgr.getInstance().gameData_CF.NEEDAUTH&&1===DataMgr.getInstance().userData.isAuth&&DataMgr.getInstance().userData.signIn===!1&&IndexPage.instance&&IndexPage.instance.addChild(new EverydayGiftWin)})["catch"](function(t){console.error(t),wx.hideLoading(),wx.showToast({title:"网络错误，请重试",icon:"none",duration:2e3});var e=setTimeout(function(){wx.exitMiniProgram({}),clearTimeout(e),e=null},2e3)})},e.prototype.addTimerSaveUserGameInfo=function(){var t=15e3;setInterval(function(){Net.storeUserGameInfo({coin:DataMgr.getInstance().userData.coin,gameProps:DataMgr.getInstance().userData.gameProps,totalStar:DataMgr.getInstance().userData.totalStar})},t)},e.prototype.addDiamondForInvitor=function(){var t=this;this.options.query&&this.options.query.uid&&DataMgr.getInstance().gameData_LG.isLogined&&String(this.options.query.uid)!==String(DataMgr.getInstance().userData.uid)&&Net.changeInviteFriendsData(this.options.query.uid).then(function(e){console.log("给分享的"+t.options.query.uid+"添加金币",e)})["catch"](function(t){console.error("添加金币接口报错",t)})},e.dimondLackTips=function(t){wx.showModal({title:"提示：",content:"您的金币不足了，是否前往获取金币?",success:function(a){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(n){switch(n.label){case 0:return GlueUtils.RemoveChild(t),e.Stage.addChild(new IndexPage),a.confirm!==!0?[3,2]:[4,AssetsLoadMgr.loadGroup("Window")];case 1:return n.sent(),Math.random()>.7&&0===DataMgr.getInstance().gameData_LG.isAudit?IndexPage.instance.addChild(new InviteGiftWin):IndexPage.instance.addChild(new FreeLottoWind),[3,3];case 2:a.cancel===!0,n.label=3;case 3:return[2]}})})},fail:function(t){console.error(t)}})},e.addBanner=function(t,a,n,i,s){return void 0===a&&(a=null),void 0===n&&(n=300),void 0===i&&(i=(window.innerWidth-300)/2),void 0===s&&(s=window.innerHeight-.28*window.innerWidth),e.banner?void e.banner.show().then(function(){a&&a()}):(e.banner=wx.createBannerAd({adUnitId:DataMgr.getInstance().gameData_LG.banner[_.random(0,DataMgr.getInstance().gameData_LG.banner.length-1)],style:{width:n,left:i,top:s}}),e.banner.onError(function(t){console.error("广告加载错误",t),e.removeBanner()}),void e.banner.onLoad(function(){t.parent?e.banner.show().then(function(){a&&a()})["catch"](function(t){console.error("广告组显示发生错误",t)}):e.removeBanner()}))},e.removeBanner=function(t){void 0===t&&(t=null),e.banner&&(e.banner.hide(),e.banner.destroy(),e.banner=null,t&&t())},e.showBanner=function(){e.banner&&e.banner.show()},e.hideBanner=function(){e.banner&&e.banner.hide()},e.addGameBlub=function(){e.gameClub=wx.createGameClubButton({icon:"white",style:{width:.1*window.innerWidth,height:.1*window.innerWidth,left:660*window.innerWidth/750,top:140*window.innerHeight/1334}}),e.gameClub.show()},e.showGameClub=function(){e.gameClub?e.gameClub.show():e.addGameBlub()},e.hideGameClub=function(){e.gameClub&&e.gameClub.hide()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var Toast=function(t){function e(a,n){var i=t.call(this)||this;return i.callBack=n,i.once(egret.Event.ADDED_TO_STAGE,function(t){e.instance=i,i.init(a)},i),i.once(egret.Event.REMOVED_FROM_STAGE,function(t){e.instance=null},i),i}return __extends(e,t),e.prototype.init=function(t){var e=new Mask;this.addChild(e),this.content=new egret.DisplayObjectContainer,this.content.anchorOffsetX=this.content.width/2,this.content.anchorOffsetY=this.content.height/2,this.content.x=this.width/2,this.content.y=this.height/2,this.addChild(this.content);var a=GlueUtils.createImg("toastBg_png",572,354,0,0);this.content.addChild(a);var n=GlueUtils.createImg("window_close_png",90,90,245,-260);n.touchEnabled=!0,n.once(egret.TouchEvent.TOUCH_TAP,this.close,this),this.content.addChild(n);var i=GlueUtils.createImg("toastComfire_png",256,86,0,90);i.touchEnabled=!0,i.once(egret.TouchEvent.TOUCH_TAP,this.close,this),this.content.addChild(i);var s=new egret.TextField;s.width=400,s.height=200,s.textAlign=egret.HorizontalAlign.CENTER,s.verticalAlign=egret.VerticalAlign.MIDDLE,s.x=-200,s.y=-140,s.lineSpacing=20,s.size=36,s.text=t,s.textColor=2452427,this.content.addChild(s),Animation.toBig(this.content)},e.prototype.close=function(){var t=this;Animation.toSmall(this.content,function(){GlueUtils.RemoveChild(t),t.callBack&&t.callBack()})},e}(egret.DisplayObjectContainer);__reflect(Toast.prototype,"Toast");var ChooseLevelPage=function(t){function e(){var a=t.call(this)||this;return a.once(egret.Event.ADDED_TO_STAGE,function(t){e.instance=a,a.init(),Main.addBanner(a)},a),a.once(egret.Event.REMOVED_FROM_STAGE,function(t){e.instance=null,Main.hideBanner()},a),a}return __extends(e,t),e.prototype.init=function(){this.addBg(),this.addReurnIndexPage(),this.addCoinIcon(),this.addDimondText(),this.addMusicList()},e.prototype.addBg=function(){var t=GlueUtils.createImg("home_bg_jpg",Main.StageWidth,Main.StageHeight,Main.StageWidth/2,Main.StageHeight/2);this.addChild(t);var e=GlueUtils.createImg("chooseHat_png",710,82,Main.StageWidth/2,300*Main.K_H);this.addChild(e)},e.prototype.addReurnIndexPage=function(){var t=this.gotoIndexPage.bind(this),e=new Button({url:"window_return_png",width:90,height:90,x:72,y:100*Main.K_H,filter:[],callBack:t});this.addChild(e),GlueUtils.removedListener(e,egret.TouchEvent.TOUCH_TAP,t,this)},e.prototype.gotoIndexPage=function(){GlueUtils.RemoveChild(this),Main.Stage.addChild(new IndexPage)},e.prototype.addCoinIcon=function(){var t=GlueUtils.createImg("index_coin_png",208,70,150,210*Main.K_H);this.addChild(t)},e.prototype.addDimondText=function(){this.diamondText=new egret.TextField,this.diamondText.width=140,this.diamondText.x=110,this.diamondText.y=194*Main.K_H,this.diamondText.textAlign=egret.HorizontalAlign.CENTER,this.diamondText.size=34,this.diamondText.text=DataMgr.getInstance().userData.coin+"",this.addChild(this.diamondText)},e.prototype.addMusicList=function(){var t=this,e=new egret.DisplayObjectContainer,a=RES.getRes("chooseItemBg_png"),n=(RES.getRes("coinIcon_png"),RES.getRes("star_png")),i=(RES.getRes("starBg_png"),206),s=new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0]),o=BusUtils.getLevelByStar(),r=BusUtils.getStarNumByLevel(o);DataMgr.getInstance().gameData_LG.levelTitle.forEach(function(h,d){if(!(d>o+1)){var c=new egret.Bitmap(a);c.width=700,c.height=196,c.x=0,c.y=d*i,c.touchEnabled=d===o+1?!1:!0;var g=t.navGamePage.bind(t,d);c.addEventListener(egret.TouchEvent.TOUCH_TAP,g,t),GlueUtils.removedListener(c,egret.TouchEvent.TOUCH_TAP,g,t),e.addChild(c);var l=GlueUtils.createImg("grad_json.grad"+d+"_png",126,126,80,d*i+90);e.addChild(l);var u=new egret.TextField;u.x=170,u.y=68+d*i,u.textColor=13464128,u.size=38,u.text=DataMgr.getInstance().gameData_LG.levelTitle[d],e.addChild(u);var m=new egret.TextField;switch(m.x=480,m.y=36+d*i,m.textColor=13464128,m.size=34,m.text="入场费："+BusUtils.getEntranceCostNumber(d),e.addChild(m),d){case 0:var p=new egret.Bitmap(n);p.width=40,p.height=40,p.x=616,p.y=96+d*i,p.filters=d===o&&0>=r||d===o+1?[s]:[],e.addChild(p);var v=new egret.Bitmap(n);v.width=40,v.height=40,v.x=572,v.y=96+d*i,v.filters=d===o&&1>=r||d===o+1?[s]:[],e.addChild(v);break;case 1:var w=new egret.Bitmap(n);w.width=40,w.height=40,w.x=616,w.y=96+d*i,w.filters=d===o&&0>=r||d===o+1?[s]:[],e.addChild(w);var f=new egret.Bitmap(n);f.width=40,f.height=40,f.x=572,f.y=96+d*i,f.filters=d===o&&1>=r||d===o+1?[s]:[],e.addChild(f);var D=new egret.Bitmap(n);D.width=40,D.height=40,D.x=528,D.y=96+d*i,D.filters=d===o&&2>=r||d===o+1?[s]:[],e.addChild(D);var y=new egret.Bitmap(n);y.width=40,y.height=40,y.x=484,y.y=96+d*i,y.filters=d===o&&3>=r||d===o+1?[s]:[],e.addChild(y);break;case DataMgr.getInstance().gameData_LG.levelTitle.length-1:var _=new egret.Bitmap(n);_.width=40,_.height=40,_.x=520,_.y=96+d*i,_.filters=d===o&&0>=r||d===o+1?[s]:[],e.addChild(_);var T=new egret.TextField;T.x=570,T.y=100+d*i,T.text="x"+r,T.size=36,T.textColor=13464128,e.addChild(T);break;default:var I=new egret.Bitmap(n);I.width=40,I.height=40,I.x=616,I.y=96+d*i,I.filters=d===o&&0>=r||d===o+1?[s]:[],e.addChild(I);var C=new egret.Bitmap(n);C.width=40,C.height=40,C.x=572,C.y=96+d*i,C.filters=d===o&&1>=r||d===o+1?[s]:[],e.addChild(C);var M=new egret.Bitmap(n);M.width=40,M.height=40,M.x=528,M.y=96+d*i,M.filters=d===o&&2>=r||d===o+1?[s]:[],e.addChild(M);var x=new egret.Bitmap(n);x.width=40,x.height=40,x.x=484,x.y=96+d*i,x.filters=d===o&&3>=r||d===o+1?[s]:[],e.addChild(x);var E=new egret.Bitmap(n);E.width=40,E.height=40,E.x=440,E.y=96+d*i,E.filters=d===o&&4>=r||d===o+1?[s]:[],e.addChild(E);var b=new egret.Bitmap(n);b.width=40,b.height=40,b.x=396,b.y=96+d*i,b.filters=d===o&&5>=r||d===o+1?[s]:[],e.addChild(b)}}});var h=GlueUtils.createBitmapByName("listBg_png");if(h.width=e.width,h.height=e.height,h.x=0,h.y=0,h.touchEnabled=!1,e.addChildAt(h,0),o!==DataMgr.getInstance().gameData_LG.levelTitle.length-1){var d=GlueUtils.createBitmapByName("lockBg_png");d.width=694,d.height=348,d.x=0,d.y=(o+1)*i,d.touchEnabled=!0,e.addChild(d)}var c=new egret.ScrollView;c.name="scrollView",c.removeContent(),c.setContent(e),this.getChildByName("scrollView")&&GlueUtils.RemoveChild(this.getChildByName("scrollView")),c.height=850*Main.K_H,c.x=(Main.StageWidth-c.width)/2,c.y=296*Main.K_H,this.addChild(c),(o+2)*i>850*Main.K_H&&c.setScrollTop((o+2)*i-850*Main.K_H+140,300)},e.prototype.navGamePage=function(t){var a=BusUtils.getEntranceCostNumber(t);DataMgr.getInstance().userData.coin<a?Main.dimondLackTips(e.instance):(GlueUtils.RemoveChild(this),Main.Stage.addChild(new MatchPage(!1)),DataMgr.getInstance().tempData.gameLevel=t)},e}(egret.DisplayObjectContainer);__reflect(ChooseLevelPage.prototype,"ChooseLevelPage");var GameOverPage=function(t){function e(a){var n=t.call(this)||this;return n.addEventListener(egret.Event.ADDED_TO_STAGE,function(t){e.instance=n,n.init(a),Main.addBanner(n)},n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(t){e.instance=null,Main.hideBanner()},n),n}return __extends(e,t),e.prototype.init=function(t){var e=this;this.hasNoticeReady=!1;var a=new Mask;this.addChild(a);var n,i=new egret.TextField;i.width=370,i.textAlign=egret.HorizontalAlign.CENTER,i.x=(Main.StageWidth-i.width)/2,i.y=356,i.size=32,i.textColor=9922083;var s=new egret.TextField;s.x=420,s.y=656,s.size=34,s.textColor=9922083;var o=GlueUtils.createImg("star_png",44,44,366,736),r=new egret.TextField;switch(r.x=420,r.y=720,r.size=34,r.textColor=9922083,t){case GameOverResult.WIN:i.text="您已取得胜利";var h=Math.floor(.8*BusUtils.getEntranceCostNumber(DataMgr.getInstance().tempData.gameLevel));s.text="+"+h,DataMgr.getInstance().userData.coin+=h,DataMgr.getInstance().tempData.gameLevel===BusUtils.getLevelByStar()?(r.text="+1",DataMgr.getInstance().userData.totalStar+=1):r.text="+0",n=GlueUtils.createBitmapByName("winBg_png"),n.height=1022,n.y=44;break;case GameOverResult.LOSE:i.text="您被击败了";var d=BusUtils.getEntranceCostNumber(DataMgr.getInstance().tempData.gameLevel);if(s.text="-"+d,DataMgr.getInstance().userData.coin-=d,DataMgr.getInstance().tempData.gameLevel===BusUtils.getLevelByStar())if(DataMgr.getInstance().userData.gameProps.reviveCard>0){DataMgr.getInstance().userData.gameProps.reviveCard--,r.text="+0";var c=setTimeout(function(){e.addChild(new Toast("续命丹生效，本局不掉星")),clearTimeout(c),c=null},100)}else r.text="-1",DataMgr.getInstance().userData.totalStar-=1,DataMgr.getInstance().userData.totalStar<0&&(DataMgr.getInstance().userData.totalStar=0);else r.text="+0";n=GlueUtils.createBitmapByName("failBg_png"),n.height=884,n.y=184;break;case GameOverResult.TIE:i.text="大家打了个平手";var g=Math.floor(.2*BusUtils.getEntranceCostNumber(DataMgr.getInstance().tempData.gameLevel));s.text="-"+g,DataMgr.getInstance().userData.coin-=g,r.text="+0",n=GlueUtils.createBitmapByName("tieBg_png"),n.height=884,n.y=184}if(n.width=636,n.x=(Main.StageWidth-n.width)/2,this.addChild(n),this.addChild(o),this.addChild(r),this.addChild(i),this.addChild(s),this.addAvatar(this,DataMgr.getInstance().userData,140,376,530),this.againPlayBtn=GlueUtils.createBitmapByName("againPlayBtn_png"),this.againPlayBtn.width=400,this.againPlayBtn.height=76,this.againPlayBtn.x=(Main.StageWidth-this.againPlayBtn.width)/2,this.againPlayBtn.y=820,this.againPlayBtn.touchEnabled=!0,this.againPlayBtn.once(egret.TouchEvent.TOUCH_TAP,function(){this.notice_PlayAgain()},this),this.addChild(this.againPlayBtn),GamePage.instance&&GamePage.instance.getRobotModal())var l=setTimeout(function(){e.againPlayBtn.filters=[new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0])],e.againPlayBtn.touchEnabled=!1,e.againPlayText.text="对手已离开房间",clearTimeout(l),l=null},_.random(3e3,6e3));this.againPlayText=new egret.TextField,this.againPlayText.width=400,this.againPlayText.textAlign=egret.HorizontalAlign.CENTER,this.againPlayText.x=(Main.StageWidth-this.againPlayText.width)/2,this.againPlayText.y=834,this.againPlayText.size=34,this.againPlayText.textColor=16777215,this.againPlayText.text="再来一局",this.addChild(this.againPlayText);var u=this.notice_LeaveRoom.bind(this),m=new Button({url:"exchangeEnemy_png",width:400,height:76,x:Main.StageWidth/2,y:970,callBack:u});GlueUtils.removedListener(m,egret.TouchEvent.TOUCH_TAP,u,this),this.addChild(m)},e.prototype.notice_PlayAgain=function(){if(this.hasNoticeReady=!0,this.againPlayBtn.touchEnabled=!1,this.againPlayBtn.filters=[new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0])],this.againPlayText.text="您已经准备",!GamePage.instance||!GamePage.instance.getRobotModal()){var t=[{status:6}],e={uid:DataMgr.getInstance().userData.uid,to_uid:DataMgr.getInstance().userData.matchingData.enemyUserInfo.uid,act:2,data:t};Socket.getInstance().sendMessage(e);var a={uid:DataMgr.getInstance().userData.uid,to_uid:DataMgr.getInstance().userData.matchingData.enemyUserInfo.uid,act:5,data:{}};Socket.getInstance().sendMessage(a)}},e.prototype.notice_LeaveRoom=function(){if(GamePage.instance&&!GamePage.instance.getRobotModal()){var t={uid:DataMgr.getInstance().userData.uid,to_uid:DataMgr.getInstance().userData.matchingData.enemyUserInfo.uid,act:3,data:{}};Socket.getInstance().sendMessage(t),Socket.getInstance().closeTunnel()}Main.Stage.removeChildren(),Main.Stage.addChildAt(new IndexPage,0),DataMgr.getInstance().tempData.gameLevel=null,DataMgr.getInstance().tempData.msgText=[]},e.prototype.listen_LeaveRoom=function(){this.againPlayBtn.touchEnabled=!1,this.againPlayBtn.filters=[new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0])],this.againPlayText.text="对方已离开房间"},e.prototype.listen_PlayAgain=function(){if(!this.hasNoticeReady){var t=new Toast("对方已经准备");this.addChild(t)}},e.prototype.addAvatar=function(t,e,a,n,i){RES.getResByUrl(e.avatarUrl,function(t){var e=new egret.Bitmap(t);e.width=a,e.height=e.width,e.anchorOffsetX=.5*e.width,e.anchorOffsetY=.5*e.height,e.x=n,e.y=i;var s=new egret.Shape;s.graphics.beginFill(255),s.graphics.drawCircle(e.x,e.y,e.width/2),s.graphics.endFill(),this.addChild(s),e.mask=s;var o=new egret.Shape,r="r"===DataMgr.getInstance().userData.matchingData.myTeam?16299012:4502007;o.graphics.beginFill(r),o.graphics.lineStyle(10,r),o.graphics.drawCircle(e.x,e.y,.5*e.width),o.graphics.endFill(),this.addChild(o),this.addChild(e)},t,RES.ResourceItem.TYPE_IMAGE)},e}(egret.DisplayObjectContainer);__reflect(GameOverPage.prototype,"GameOverPage");var Animation=function(){function t(){}return t.toBigtoSmallLoop=function(t,e,a,n,i,s,o){void 0===i&&(i=0),void 0===s&&(s=egret.Ease.sineInOut),void 0===o&&(o=0),t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,egret.Tween.get(t,{loop:!0}).to({scaleX:e,scaleY:a},n/2,s).wait(o).to({scaleX:1,scaleY:1},n/2,s)},t.toBig=function(t,e){t.scaleX=0,t.scaleY=0,egret.Tween.get(t).to({scaleX:1.1,scaleY:1.1},280).to({scaleX:1,scaleY:1},100).call(function(){e&&e()})},t.toSmall=function(t,e){egret.Tween.get(t).to({scaleX:1.1,scaleY:1.1},100).to({scaleX:0,scaleY:0},280).call(function(){e&&e()})},t}();__reflect(Animation.prototype,"Animation");var HelpPage=function(t){function e(){var a=t.call(this)||this;return a.once(egret.Event.ADDED_TO_STAGE,function(t){e.instance=a,a.init()},a),a.once(egret.Event.REMOVED_FROM_STAGE,function(t){e.instance=null},a),a}return __extends(e,t),e.prototype.init=function(){var t=new Mask;this.addChild(t),this.helpImg=GlueUtils.createImg("indexHelp_png",660,852,Main.StageWidth/2,Main.StageHeight/2),this.addChild(this.helpImg),Animation.toBig(this.helpImg);var e=GlueUtils.createImg("game_json.lawn_png",56,56,630,Main.StageHeight/2-360);e.touchEnabled=!0,e.once(egret.TouchEvent.TOUCH_TAP,this.close,this),this.addChild(e)},e.prototype.close=function(){Animation.toSmall(this.helpImg,function(){GlueUtils.RemoveChild(e.instance),e.instance=null})},e}(egret.DisplayObjectContainer);__reflect(HelpPage.prototype,"HelpPage");var IndexPage=function(t){function e(){var a=t.call(this)||this;return a.once(egret.Event.ADDED_TO_STAGE,function(t){e.instance=a,a.init()},a),a.once(egret.Event.REMOVED_FROM_STAGE,function(t){e.instance=null,Main.hideGameClub()},a),a}return __extends(e,t),e.prototype.init=function(){this.addBg(),this.addCoinIcon(),this.addDimondText(),this.addVoiceBtn(),this.addSign(),0===DataMgr.getInstance().gameData_LG.isAudit&&this.addInviteGift(),this.addGetCoin(),DataMgr.getInstance().gameData_LG.showGameClub&&Main.addGameBlub(),this.addChooseLevelBtn(),this.addGradText(),this.addFriendsMathBtn(),this.addRankBtn(),0===DataMgr.getInstance().gameData_LG.isAudit&&this.otherXcx(),this.addTurnpanel(),this.addPersonCenter(),this.addShop(),DataMgr.getInstance().gameData_LG.isLogined&&this.updateIndexPageData()},e.prototype.addBg=function(){var t=GlueUtils.createImg("home_bg_jpg",Main.StageWidth,Main.StageHeight,Main.StageWidth/2,Main.StageHeight/2);this.addChild(t)},e.prototype.addCoinIcon=function(){var t=GlueUtils.createImg("index_coin_png",140,48,100,44);this.addChild(t)},e.prototype.addDimondText=function(){this.diamondText=new egret.TextField,this.diamondText.width=110,this.diamondText.x=66,this.diamondText.y=26,this.diamondText.textAlign=egret.HorizontalAlign.CENTER,this.diamondText.size=32,this.diamondText.text="0",this.addChild(this.diamondText)},e.prototype.addVoiceBtn=function(){var t=this;this.voiceBtn=GlueUtils.creatButton({url:DataMgr.getInstance().userData.musicIsOpen?"index_voice_open_png":"index_voice_close_png",width:60,height:60,x:54,y:132*Main.K_H,callBack:t.onOffVoice.bind(t),scale:1.1,filter:[]}),this.addChild(this.voiceBtn)},e.prototype.onOffVoice=function(){DataMgr.getInstance().userData.musicIsOpen=!DataMgr.getInstance().userData.musicIsOpen,this.voiceBtn.changeBg(RES.getRes(DataMgr.getInstance().userData.musicIsOpen?"index_voice_open_png":"index_voice_close_png")),!DataMgr.getInstance().userData.musicIsOpen},e.prototype.addSign=function(){var t=this,e=GlueUtils.creatButton({url:"index_sign_png",width:106,height:98,x:194,y:100*Main.K_H,callBack:t.navToSignPage.bind(t)});this.addChild(e)},e.prototype.navToSignPage=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,AssetsLoadMgr.loadGroup("Window")];case 1:return t.sent(),e.instance.addChild(new EverydayGiftWin),[2]}})})},e.prototype.addInviteGift=function(){var t=this.gotoInviteGiftPage.bind(this),e=new Button({url:"index_invite_png",width:106,height:98,x:320,y:100*Main.K_H,callBack:t});this.addChild(e),GlueUtils.removedListener(e,egret.TouchEvent.TOUCH_TAP,t,this)},e.prototype.gotoInviteGiftPage=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,AssetsLoadMgr.loadGroup("Window")];case 1:return t.sent(),this.addChild(new InviteGiftWin),[2]}})})},e.prototype.addGetCoin=function(){var t=this,e=GlueUtils.creatButton({url:"index_freeCoin_png",width:106,height:98,x:440,y:100*Main.K_H,callBack:t.getCoin.bind(t)});this.addChild(e)},e.prototype.getCoin=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(a){return t=wx.createRewardedVideoAd({adUnitId:"adunit-6e602366a041e532"}),t.load().then(function(){return t.show()})["catch"](function(t){return console.log(t.errMsg)}),t.onError(function(t){console.error(t),wx.showToast({title:"获取广告失败",icon:"none",duration:3e3})}),t.onClose(function n(a){t.offClose(n),a&&a.isEnded||void 0===a?(DataMgr.getInstance().userData.coin+=100,e.instance.updateDiamondText(),Main.Stage.addChild(new Toast("恭喜获得100金币"))):console.log("中途退出")}),[2]})})},e.prototype.addChooseLevelBtn=function(){this.getChildByName("chooseLevelIcon")&&GlueUtils.RemoveChild(this.getChildByName("chooseLevelIcon"));var t=this.gotoChooseLevelPage.bind(this),e=new Button({url:"chooseLevelIcon_png",width:680,height:300,x:Main.StageWidth/2,y:410*Main.K_H,scale:1,callBack:t});GlueUtils.removedListener(e,egret.TouchEvent.TOUCH_TAP,t,this),e.name="chooseLevelIcon",this.addChild(e)},e.prototype.gotoChooseLevelPage=function(){GlueUtils.RemoveChild(e.instance),Main.Stage.addChild(new ChooseLevelPage)},e.prototype.addGradText=function(){this.gradText=new egret.TextField,this.gradText.width=200,this.gradText.textAlign=egret.HorizontalAlign.CENTER,this.gradText.x=76,this.gradText.y=410*Main.K_H+2,this.gradText.size=32,this.gradText.text=DataMgr.getInstance().gameData_LG.levelTitle[BusUtils.getLevelByStar()],this.addChild(this.gradText)},e.prototype.addFriendsMathBtn=function(){var t=this.gotoFriendMatchPage.bind(this),e=new Button({url:"index_friendNav_png",width:400,height:284,x:240,y:710*Main.K_H,callBack:t});GlueUtils.removedListener(e,egret.TouchEvent.TOUCH_TAP,t,this),this.addChild(e)},e.prototype.gotoFriendMatchPage=function(){this.shareOnshowCallBackBind=this.shareOnhideCallBack.bind(this,(new Date).getTime()),wx.onShow(this.shareOnshowCallBackBind),wx.shareAppMessage({title:DataMgr.getInstance().gameData_LG.shareInfo.title,imageUrl:DataMgr.getInstance().gameData_LG.shareInfo.url,query:"uid="+DataMgr.getInstance().userData.uid+"&FriendsFight="+!0})},e.prototype.shareOnhideCallBack=function(t){console.log("触发onshow回调",(new Date).getTime()-t),wx.offShow(this.shareOnshowCallBackBind),(new Date).getTime()-t<1e3?wx.showToast({title:"分享失败",icon:"none",duration:1500}):(GlueUtils.RemoveChild(e.instance),Main.Stage.addChild(new MatchFriendPage))},e.prototype.addRankBtn=function(){var t=this.gotoRankPage.bind(this),e=new Button({url:"index_rank_png",width:306,height:284,x:564,y:710*Main.K_H,callBack:t});GlueUtils.removedListener(e,egret.TouchEvent.TOUCH_TAP,t,this),this.addChild(e)},e.prototype.gotoRankPage=function(){GlueUtils.RemoveChild(e.instance),Main.Stage.addChild(new RankPage)},e.prototype.otherXcx=function(){var t=this,e=GlueUtils.createBitmapByName("moreBg_png");e.width=750,e.height=157,e.x=0,e.y=940*Main.K_H,t.addChild(e),e.touchEnabled=!0;var a=GlueUtils.createBitmapByName("more1_png");a.width=103,a.height=133,a.x=70,a.y=e.y+11,t.addChild(a),a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){var t=/iOS/;wx.getSystemInfo({success:function(e){t.test(e.system)?wx.navigateToMiniProgram({appId:"wxffec2c17f7946819",path:"pages/index/index",envVersion:"release"}):wx.navigateToMiniProgram({appId:"wx5e2ca94f8a7d4ce0",path:"pages/index/index",envVersion:"release"})}})},this);var n=GlueUtils.createBitmapByName("more2_png");n.width=103,n.height=133,n.x=256+n.width/2,n.y=e.y+11+n.height/2,n.$anchorOffsetX=n.width/2,n.$anchorOffsetY=n.height/2,t.addChild(n),n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){wx.navigateToMiniProgram({appId:"wx88d5db6a90fbf360",path:"pages/index/index",envVersion:"release"})},this),egret.Tween.get(n,{loop:!0}).to({rotation:15},300).to({rotation:0},300).to({rotation:-15},300).to({rotation:0},300).to({rotation:0},1e3).call(function(){});var i=GlueUtils.createBitmapByName("more3_png");i.width=103,i.height=133,i.x=439,i.y=e.y+11,t.addChild(i),i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){wx.navigateToMiniProgram({appId:"wxc6fc301d44ef11a3",path:"pages/index/index",envVersion:"release"})},this);var s=GlueUtils.createBitmapByName("more4_png");s.width=103,s.height=133,s.x=615+s.width/2,s.y=e.y+11+s.height/2,s.$anchorOffsetX=s.width/2,s.$anchorOffsetY=s.height/2,t.addChild(s),s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){wx.navigateToMiniProgram({appId:"wx3d7f3ea7e3793fa3",path:"pages/index/index",envVersion:"release"})},this),egret.Tween.get(s,{loop:!0}).to({rotation:15},250).to({rotation:0},250).to({rotation:-15},250).to({rotation:0},230).to({rotation:0},1e3).call(function(){})},e.prototype.addPersonCenter=function(){var t=this.navToPersonCenter.bind(this),e=new Button({url:"index_person_png",width:128,height:145,x:192,y:1236*Main.K_H,callBack:t});this.addChild(e),GlueUtils.removedListener(e,egret.TouchEvent.TOUCH_TAP,t,this)},e.prototype.navToPersonCenter=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,AssetsLoadMgr.loadGroup("Window")];case 1:return t.sent(),e.instance.addChild(new PersonCenter),[2]}})})},e.prototype.addTurnpanel=function(){var t=this.navToTurnpanel.bind(this),e=GlueUtils.creatButton({url:"index_turn_png",width:128,height:145,x:380,y:1236*Main.K_H,callBack:t});this.addChild(e),GlueUtils.removedListener(e,egret.TouchEvent.TOUCH_TAP,t,this)},e.prototype.navToTurnpanel=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,AssetsLoadMgr.loadGroup("Window")];case 1:return t.sent(),e.instance.addChild(new FreeLottoWind),[2]}})})},e.prototype.addShop=function(){var t=this.navToShop.bind(this),e=GlueUtils.creatButton({url:"index_shop_png",width:128,height:145,x:580,y:1236*Main.K_H,callBack:t});this.addChild(e),GlueUtils.removedListener(e,egret.TouchEvent.TOUCH_TAP,t,this)},e.prototype.navToShop=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,AssetsLoadMgr.loadGroup("Window")];case 1:return t.sent(),e.instance.addChild(new Shop),[2]}})})},e.prototype.updateIndexPageData=function(){0===DataMgr.getInstance().gameData_LG.isAudit&&this.addInviteGift(),this.diamondText.text=DataMgr.getInstance().userData.coin+"",this.gradText.text=DataMgr.getInstance().gameData_LG.levelTitle[BusUtils.getLevelByStar()],0===DataMgr.getInstance().gameData_LG.isAudit&&this.otherXcx()},e.prototype.updateDiamondText=function(){this.diamondText&&(this.diamondText.text=DataMgr.getInstance().userData.coin+"")},e}(egret.DisplayObjectContainer);__reflect(IndexPage.prototype,"IndexPage");var MatchFriendPage=function(t){function e(e){return t.call(this,!0,e)||this}return __extends(e,t),e.prototype.addBtns=function(){var t=this.gotoChooseLevelPage.bind(this),e=GlueUtils.creatButton({url:"match_quitBtn_png",width:254,height:84,x:226,y:1100*Main.K_H,callBack:t});this.addChild(e),GlueUtils.removedListener(e,egret.TouchEvent.TOUCH_TAP,t,this);var a=this.inviteFiends.bind(this),n=GlueUtils.creatButton({url:"match_inviteBtn_png",width:254,height:84,x:528,y:1100*Main.K_H,callBack:a});this.addChild(n),GlueUtils.removedListener(n,egret.TouchEvent.TOUCH_TAP,a,this)},e.prototype.inviteFiends=function(){wx.shareAppMessage({title:DataMgr.getInstance().gameData_LG.shareInfo.title,imageUrl:DataMgr.getInstance().gameData_LG.shareInfo.url,query:"uid="+DataMgr.getInstance().userData.uid+"&FriendsFight="+!0})},e.prototype.gotoChooseLevelPage=function(){GlueUtils.RemoveChild(this),Main.Stage.addChild(new IndexPage),Socket.getInstance().closeTunnel(),Socket.getInstance().removeAllEventListener(),clearTimeout(this.matchRobotTimer),this.matchRobotTimer=null},e}(MatchPage);__reflect(MatchFriendPage.prototype,"MatchFriendPage");var AssetsLoadMgr=function(){function t(){}return t.loadLoadingGroup=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),RES.setMaxLoadingThread(1),t.assetsLoading=!0,[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return a.sent(),[4,RES.loadGroup("Loading")];case 2:return a.sent(),t.assetsLoading=!1,[3,4];
case 3:return e=a.sent(),console.error("loadLoadingGroup:",e),[3,4];case 4:return[2]}})})},t.loadGroup=function(e){return t.assetsLoading?void wx.showToast({title:"加载中..",icon:"loading",duration:1500}):new Promise(function(a,n){if(RES.isGroupLoaded(e))a();else{t.assetsLoading=!0;var i="IndexPage"===e?new LoadingUI_Index:new LoadingUI_Normal;Main.Stage.addChild(i),RES.loadGroup(e,0,i).then(function(e){t.assetsLoading=!1,GlueUtils.RemoveChild(i),a()})["catch"](function(t){console.error(e+"资源组加载错误:",t),n()})}})},t.assetsLoading=!1,t}();__reflect(AssetsLoadMgr.prototype,"AssetsLoadMgr");var RankPage=function(t){function e(){var a=t.call(this)||this;return a.addEventListener(egret.Event.ADDED_TO_STAGE,function(t){a.init(),Main.addBanner(a)},a),a.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(t){e.instance=null,Main.hideBanner()},a),a}return __extends(e,t),e.prototype.init=function(){e.instance=this,this.addBg(),this.addFriendsRank(),this.addBackBtn(),this.seeGroupRank(),this.fluantRank()},e.prototype.addBg=function(){var t=GlueUtils.createBitmapByName("home_bg_jpg");t.width=Main.StageWidth,t.height=Main.StageHeight,this.addChild(t);var e=GlueUtils.createImg("rank_title_png",700,1006,Main.StageWidth/2,Main.BaseLine-134);this.addChild(e)},e.prototype.addFriendsRank=function(){this.openDataContext=window.openDataContext,this.addChild(this.openDataContext.createDisplayObject(null,Main.StageWidth,Main.StageHeight)),this.openDataContext.postMessage({command:"open",type:"friendsRank",key:"totalStar",openId:DataMgr.getInstance().userData.openId})},e.prototype.addBackBtn=function(){var t=this,a=new Button({url:"window_return_png",width:90,height:90,x:76,y:100*Main.K_H,scale:1,callBack:e.instance.returnIndex.bind(t)});this.addChild(a)},e.prototype.returnIndex=function(){e.instance.openDataContext.postMessage({command:"close"}),GlueUtils.RemoveChild(e.instance),Main.Stage.addChild(new IndexPage)},e.prototype.seeGroupRank=function(){var t=this,e=new Button({url:"seeGroupRank_png",width:290,height:80,x:196,y:Main.BaseLine+434,callBack:t.seeGroup.bind(t)});this.addChild(e)},e.prototype.seeGroup=function(){wx.shareAppMessage({title:DataMgr.getInstance().gameData_LG.shareInfo.title,imageUrl:DataMgr.getInstance().gameData_LG.shareInfo.url,query:"uid="+DataMgr.getInstance().userData.uid,success:function(t){console.log("分享成功",t)},fail:function(t){console.error("分享失败",t)}})},e.prototype.fluantRank=function(){var t=this,e=new Button({url:"flauntRank_png",width:290,height:80,x:558,y:Main.BaseLine+434,callBack:t.seeGroup.bind(t)});this.addChild(e)},e}(egret.DisplayObjectContainer);__reflect(RankPage.prototype,"RankPage");var Animal=function(t){function e(e){var a=t.call(this)||this;return a.isOpened=!1,a.moveDirection=[],a.id=e,a.init(),a}return __extends(e,t),e.prototype.getId=function(){return this.id},e.prototype.setId=function(t){this.id=t},e.prototype.getColor=function(){return this.color},e.prototype.getNumber=function(){return Number(this.number)},e.prototype.getIsOpen=function(){return this.isOpened},e.prototype.changeEggColor=function(t){this.eggAvatar.visible===!0&&(this.eggAvatar.filters=[t])},e.prototype.openEgg=function(t,e){void 0===t&&(t=!0),this.eggAvatar.visible=!1,this.isOpened=!0;var a=new egret.MovieClip(new egret.MovieClipDataFactory(RES.getRes("showQi_json"),RES.getRes("showQi_png")).generateMovieClipData());a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,a.x=-40,a.y=-40,this.addChild(a),a.gotoAndPlay(1,1),a.once(egret.Event.COMPLETE,function(){GlueUtils.RemoveChild(a),this.animalAvatar.visible=!0,this.animalNameImgBg.visible=!0,this.animalNameImg.visible=!0,this.foundationImg.texture="r"===this.color?RES.getRes("game_json.game_diban1_png"):RES.getRes("game_json.game_diban2_png"),e&&e()},this),t&&(AudioMgr.getInstance().sound_fan(),AudioMgr.getInstance().sound_dongwu(Number(this.number)))},e.prototype.init=function(){this.touchEnabled=!0,this.color=this.id.slice(0,this.id.indexOf("_")),this.number=this.id.slice(this.id.indexOf("_")+1),this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.foundationImg=new egret.Bitmap(RES.getRes("game_json.game_diban0_png")),this.foundationImg.width=156,this.foundationImg.height=94,this.foundationImg.anchorOffsetX=this.foundationImg.width/2,this.foundationImg.anchorOffsetY=this.foundationImg.height/2,this.addChild(this.foundationImg),this.eggAvatar=new egret.Bitmap(RES.getRes("game_json.game_dan_png")),this.eggAvatar.width=104,this.eggAvatar.height=110,this.eggAvatar.anchorOffsetX=this.foundationImg.width/2,this.eggAvatar.anchorOffsetY=this.foundationImg.height/2,this.eggAvatar.x=24,this.eggAvatar.y=-50,this.eggAvatar.visible=!0,this.addChild(this.eggAvatar),this.animalAvatar=new egret.Bitmap(RES.getRes("game_json.game_id"+this.number+"_png")),this.animalAvatar.width="8"===this.number?140:100,this.animalAvatar.height=102,this.animalAvatar.anchorOffsetX=this.foundationImg.width/2,this.animalAvatar.anchorOffsetY=this.foundationImg.height/2,this.animalAvatar.x="8"===this.number?7:27,this.animalAvatar.y=-60,this.animalAvatar.visible=!1,this.addChild(this.animalAvatar),this.animalNameImgBg=new egret.Bitmap(RES.getRes("game_json."+this.color+"NameBg_png")),this.animalNameImgBg.width=44,this.animalNameImgBg.height=44,this.animalNameImgBg.anchorOffsetX=this.foundationImg.width/2,this.animalNameImgBg.anchorOffsetY=this.foundationImg.height/2,this.animalNameImgBg.x=56,this.animalNameImgBg.y=44,this.animalNameImgBg.visible=!1,this.addChild(this.animalNameImgBg),this.animalNameImg=new egret.Bitmap(RES.getRes("game_json.game_name"+this.number+"_png")),this.animalNameImg.width=24,this.animalNameImg.height=24,this.animalNameImg.anchorOffsetX=this.foundationImg.width/2,this.animalNameImg.anchorOffsetY=this.foundationImg.height/2,this.animalNameImg.x=66,this.animalNameImg.y=54,this.animalNameImg.visible=!1,this.addChild(this.animalNameImg)},e}(egret.DisplayObjectContainer);__reflect(Animal.prototype,"Animal");var Arrow=function(t){function e(e){var a=t.call(this)||this;return a.init(e),a}return __extends(e,t),e.prototype.init=function(t){switch(this.name=t+"",this.bg=GlueUtils.createImg("game_json.jiantouBit_png",30,30,0,0),this.addChild(this.bg),this.anchorOffsetX=this.bg.width/2,this.anchorOffsetY=this.bg.height/2,t){case Direction.UP:this.bg.rotation=180,this.bg.y-=50,this.bg.x+=16,egret.Tween.get(this.bg,{loop:!0}).to({y:this.bg.y-e.distance},500).to({y:this.bg.y},500);break;case Direction.DOWN:this.bg.rotation=0,this.bg.y+=40,this.bg.x+=16,egret.Tween.get(this.bg,{loop:!0}).to({y:this.bg.y+e.distance},500).to({y:this.bg.y},500);break;case Direction.LEFT:this.bg.rotation=90,this.bg.x-=35,egret.Tween.get(this.bg,{loop:!0}).to({x:this.bg.x-e.distance},500).to({x:this.bg.x},500);break;case Direction.RIGHT:this.bg.rotation=270,this.bg.x+=65,egret.Tween.get(this.bg,{loop:!0}).to({x:this.bg.x+e.distance},500).to({x:this.bg.x},500)}},e.distance=50,e}(egret.DisplayObjectContainer);__reflect(Arrow.prototype,"Arrow");var Dialog=function(t){function e(){var a=t.call(this)||this;return a.keyboardConfirmCallBackBind=a.keyboardConfirmCallBack.bind(a),a.keyboardCompleteCallBackBind=a.keyboardConfirmCallBack.bind(a),a.once(egret.Event.ADDED_TO_STAGE,function(t){e.instance=a,a.init()},a),a.once(egret.Event.REMOVED_FROM_STAGE,function(t){e.instance=null},a),a}return __extends(e,t),e.prototype.init=function(){var t=new Mask(.4);t.touchEnabled=!0,t.once(egret.TouchEvent.TOUCH_TAP,function(){GlueUtils.RemoveChild(this)},this),this.addChild(t);var e=GlueUtils.createImg("translucenceBg_png",620,600,Main.StageWidth/2,Main.BaseLine);e.touchEnabled=!0,this.addChild(e);var a=GlueUtils.createImg("clickInput_png",526,50,Main.StageWidth/2,Main.BaseLine+100);a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.showKeyboard,this),GlueUtils.removedListener(a,egret.TouchEvent.TOUCH_TAP,this.showKeyboard,this),this.addChild(a),this.clickInputText=new egret.TextField,this.clickInputText.x=130,this.clickInputText.y=Main.BaseLine+86,this.clickInputText.size=28,this.clickInputText.text="点此输入...",this.addChild(this.clickInputText);var n=GlueUtils.createImg("sendTxtMsg_png",160,60,Main.StageWidth/2,Main.BaseLine+200);n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendMsg,this),GlueUtils.removedListener(n,egret.TouchEvent.TOUCH_TAP,this.sendMsg,this),this.addChild(n),this.addMsgList()},e.prototype.showKeyboard=function(){this.clickInputText.text="",wx.showKeyboard({defaultValue:this.clickInputText.text,maxLength:20,multiple:!0,confirmHold:!0,confirmType:"done",success:function(){}}),wx.onKeyboardConfirm(this.keyboardConfirmCallBackBind),wx.onKeyboardComplete(this.keyboardCompleteCallBackBind)},e.prototype.keyboardConfirmCallBack=function(t){this.clickInputText.text=t.value.slice(0,12),wx.hideKeyboard()},e.prototype.keyboardCompleteCallBack=function(t){this.clickInputText.text=t.value.slice(0,12),wx.offKeyboardConfirm(this.keyboardConfirmCallBackBind),wx.offKeyboardComplete(this.keyboardCompleteCallBackBind)},e.prototype.sendMsg=function(){""!==this.clickInputText.text&&(DataMgr.getInstance().tempData.msgText.push([DataMgr.getInstance().userData.matchingData.myTeam,"我方："+this.clickInputText.text]),this.notice_SendTextMsg(this.clickInputText.text),this.clickInputText.text="",this.resetContent(),DataMgr.getInstance().dispatchEvent(DataEvent.SEND_TEXT_MSG))},e.prototype.resetContent=function(){var t=this;this.scrollViewContent.removeChildren(),DataMgr.getInstance().tempData.msgText.forEach(function(e,a){var n=new egret.TextField;n.textColor="r"===e[0]?16711680:3179261,n.text=e[1],n.x=50,n.y=20+50*a,n.size=32,t.scrollViewContent.addChild(n)});var e=GlueUtils.createBitmapByName("moreGame_png");e.alpha=.7,e.width=this.scrollViewContent.width,e.height=this.scrollViewContent.height,e.x=0,e.y=0,e.touchEnabled=!1,this.scrollViewContent.addChildAt(e,0),this.scrollView.setScrollTop(50*DataMgr.getInstance().tempData.msgText.length,100)},e.prototype.addMsgList=function(){this.scrollViewContent=new egret.DisplayObjectContainer,this.scrollView=new egret.ScrollView,this.scrollView.width=580,this.scrollView.height=320,this.scrollView.x=(Main.StageWidth-this.scrollView.width)/2,this.scrollView.y=Main.BaseLine-270,this.scrollView.horizontalScrollPolicy="off",this.scrollView.removeContent(),this.scrollView.setContent(this.scrollViewContent),this.addChild(this.scrollView),this.resetContent()},e.prototype.notice_SendTextMsg=function(t){if(!GamePage.instance||!GamePage.instance.getRobotModal()){var e=[{status:8,textMsg:t}],a={uid:DataMgr.getInstance().userData.uid,to_uid:DataMgr.getInstance().userData.matchingData.enemyUserInfo.uid,act:2,data:e};Socket.getInstance().sendMessage(a)}},e}(egret.DisplayObjectContainer);__reflect(Dialog.prototype,"Dialog");var Grid=function(t){function e(e,a,n,i,s,o){var r=this;return 2>a||2>e?void console.error("网格的竖线数或者横线数不能小于2"):(r=t.call(this)||this,r.width=n,r.height=i,r.x=s,r.y=o,r.row=a-1,r.col=e-1,r.coordinate={},r.getCoordinate(),r)}return __extends(e,t),e.prototype.getCoordinate=function(){for(var t=0;t<=this.col;t++)for(var e=0;e<=this.row;e++){var a=t+""+e,n=[this.x+Math.round(t*this.width/this.col),this.y+Math.round(e*this.height/this.row)];this.coordinate[a]=n}},e}(egret.DisplayObjectContainer);__reflect(Grid.prototype,"Grid");var Lawn=function(t){function e(e){var a=t.call(this)||this;a.position=e,a.touchEnabled=!0;var n=GlueUtils.createBitmapByName("game_json.lawn_png");return n.width=160,n.height=100,a.addChild(n),a.anchorOffsetX=n.width/2,a.anchorOffsetY=n.height/2,a}return __extends(e,t),e.prototype.getPosition=function(){return this.position},e}(egret.DisplayObjectContainer);__reflect(Lawn.prototype,"Lawn");var PreDialog=function(t){function e(){var a=t.call(this)||this;return a.once(egret.Event.ADDED_TO_STAGE,function(t){e.instance=a,a.init()},a),a.once(egret.Event.REMOVED_FROM_STAGE,function(t){e.instance=null},a),a}return __extends(e,t),e.prototype.init=function(){var t=GlueUtils.createBitmapByName("chat_choose_png");t.width=474,t.height=666,this.addChild(t);var e=new egret.TextField;e.textColor=16777215,e.size=28,e.x=48,e.y=60,e.text="快点吧，我等得花儿都谢了",e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendPreMsg,this),GlueUtils.removedListener(e,egret.TouchEvent.TOUCH_TAP,this.sendPreMsg,this),this.addChild(e);var a=new egret.TextField;a.textColor=16777215,a.size=28,a.x=48,a.y=146,a.text="你这棋也下得太好了",a.touchEnabled=!0,a.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendPreMsg,this),GlueUtils.removedListener(a,egret.TouchEvent.TOUCH_TAP,this.sendPreMsg,this),this.addChild(a);var n=new egret.TextField;n.textColor=16777215,n.size=28,n.x=48,n.y=232,n.text="就你这水平，还得多练练",n.touchEnabled=!0,n.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendPreMsg,this),GlueUtils.removedListener(n,egret.TouchEvent.TOUCH_TAP,this.sendPreMsg,this),this.addChild(n);var i=new egret.TextField;i.textColor=16777215,i.size=28,i.x=48,i.y=318,i.text="真倒霉，喝凉水都塞牙",i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendPreMsg,this),GlueUtils.removedListener(i,egret.TouchEvent.TOUCH_TAP,this.sendPreMsg,this),this.addChild(i);var s=new egret.TextField;s.textColor=16777215,s.size=28,s.x=48,s.y=404,s.text="英雄，让我吃个子吧",s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendPreMsg,this),GlueUtils.removedListener(s,egret.TouchEvent.TOUCH_TAP,this.sendPreMsg,this),this.addChild(s);var o=new egret.TextField;o.textColor=16777215,o.size=28,o.x=48,o.y=490,o.text="为什么老追我呀",o.touchEnabled=!0,o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendPreMsg,this),GlueUtils.removedListener(o,egret.TouchEvent.TOUCH_TAP,this.sendPreMsg,this),this.addChild(o);var r=new egret.TextField;r.textColor=16777215,r.size=28,r.x=48,r.y=576,r.text="急什么，心急吃不了热豆腐",r.touchEnabled=!0,r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.sendPreMsg,this),GlueUtils.removedListener(r,egret.TouchEvent.TOUCH_TAP,this.sendPreMsg,this),this.addChild(r)},e.prototype.sendPreMsg=function(t){var e=t.target.text;if(DataMgr.getInstance().tempData.msgText.push([DataMgr.getInstance().userData.matchingData.myTeam,"我方："+e]),DataMgr.getInstance().dispatchEvent(DataEvent.SEND_TEXT_MSG),DataMgr.getInstance().dispatchEvent(DataEvent.HIDE_PRE_DIALOG),!GamePage.instance||!GamePage.instance.getRobotModal()){var a=[{status:8,textMsg:e}],n={uid:DataMgr.getInstance().userData.uid,to_uid:DataMgr.getInstance().userData.matchingData.enemyUserInfo.uid,act:2,data:a};Socket.getInstance().sendMessage(n)}},e}(egret.DisplayObjectContainer);__reflect(PreDialog.prototype,"PreDialog");var Robot=function(){function t(){}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.RobotReady=function(){var t=this;Net.getRototUid().then(function(e){console.log("启动机器人模式",e);var a=e.data.rand_uder[0];t.matchSucc(a)})},t.prototype.matchSucc=function(t){var e=Math.random()>.5?"r":"b";DataMgr.getInstance().userData.matchingData={chessData:this.getRandomChessData(),myTeam:e,enemyTeam:"r"===e?"b":"r",enemyUserInfo:t,enemyUid:null},GlueUtils.RemoveChild(MatchPage.instance),MatchPage.instance=null,Main.Stage.addChild(new GamePage(!0)),this.autoPlayChess()},t.prototype.autoPlayChess=function(){this.startRamdonTimer(this.palyChess.bind(this))},t.prototype.palyChess=function(){function t(){var t=e();if(t.canEatEnemyAnimal&&t.beEatedAnimal){var a=GamePage.instance.animals[t.canEatEnemyAnimal[Object.keys(t.canEatEnemyAnimal)[0]]],n=GamePage.instance.animals[Object.keys(t.beEatedAnimal)[0]];if(a.getNumber()>=n.getNumber())console.log("吃的比被吃的大"),this.moveAnimal(GamePage.instance.animals[Object.keys(t.canEatEnemyAnimal)[0]],a);else if(0===t.canEatLawn.length&&a.getNumber()<n.getNumber())console.log("吃的比被吃的小，但被吃的没地方跑"),this.moveAnimal(GamePage.instance.animals[Object.keys(t.canEatEnemyAnimal)[0]],a);else if(t.canEatLawn.length>0&&a.getNumber()<n.getNumber()){console.log("吃的比被吃的小，但被吃的有地方跑");var i=_.random(0,t.canEatLawn.length-1);this.moveAnimal(GamePage.instance.animals[Object.keys(t.canEatLawn[i])[0]],GamePage.instance.lawns[t.canEatLawn[i][Object.keys(t.canEatLawn[i])[0]]])}}else if(t.canEatEnemyAnimal&&!t.beEatedAnimal){console.log("有吃的，没被吃的");var a=GamePage.instance.animals[t.canEatEnemyAnimal[Object.keys(t.canEatEnemyAnimal)[0]]];this.moveAnimal(GamePage.instance.animals[Object.keys(t.canEatEnemyAnimal)[0]],a)}else if(!t.canEatEnemyAnimal&&t.beEatedAnimal&&t.canEatLawn.length>0){console.log("没吃的，有被吃的，有地方跑");var i=_.random(0,t.canEatLawn.length-1);this.moveAnimal(GamePage.instance.animals[Object.keys(t.canEatLawn[i])[0]],GamePage.instance.lawns[t.canEatLawn[i][Object.keys(t.canEatLawn[i])[0]]])}else if(!t.canEatEnemyAnimal&&t.beEatedAnimal&&0===t.canEatLawn.length&&this.getOneEgg())console.log("没吃的，有被吃的，没地方地方跑，优蛋砸"),this.clickEgg(GamePage.instance.animals[this.getOneEgg()]);else if(t.canEatEnemyAnimal||!t.beEatedAnimal||0!==t.canEatLawn.length||this.getOneEgg())if(!t.canEatEnemyAnimal&&!t.beEatedAnimal&&t.canEatLawn.length>0&&this.getOneEgg())if(console.log("没吃的，没被吃的,但有跑的，并且优蛋可砸"),Math.random()>.4)this.clickEgg(GamePage.instance.animals[this.getOneEgg()]);else{var i=_.random(0,t.canEatLawn.length-1);this.moveAnimal(GamePage.instance.animals[Object.keys(t.canEatLawn[i])[0]],GamePage.instance.lawns[t.canEatLawn[i][Object.keys(t.canEatLawn[i])[0]]])}else if(t.canEatEnemyAnimal||t.beEatedAnimal||0!==t.canEatLawn.length||!this.getOneEgg())if(!t.canEatEnemyAnimal&&!t.beEatedAnimal&&t.canEatLawn.length>0&&!this.getOneEgg()){console.log("没吃的，没被吃的,有跑的，没蛋可砸啊啊",t.canEatLawn);var i=_.random(0,t.canEatLawn.length-1);this.moveAnimal(GamePage.instance.animals[Object.keys(t.canEatLawn[i])[0]],GamePage.instance.lawns[t.canEatLawn[i][Object.keys(t.canEatLawn[i])[0]]])}else console.log("无期可走"),GamePage.instance.listen_Quit();else console.log("没吃的，没被吃的,没跑的，并且优蛋可砸"),this.clickEgg(GamePage.instance.animals[this.getOneEgg()]);else{console.log("没吃的，有被吃的，没地方地方跑，没蛋砸：自杀");var s=GamePage.instance.animals[Object.keys(t.beEatedAnimal)[0]];this.moveAnimal(s,GamePage.instance.animals[t.beEatedAnimal[Object.keys(t.beEatedAnimal)[0]]])}}function e(){function t(t){var e=t.length;if(0===e)return null;if(1===e)return t[0];var a=t[0];return t.forEach(function(e,n){GamePage.instance.animals[e[Object.keys(e)[0]]].getNumber()>GamePage.instance.animals[a[Object.keys(a)[0]]].getNumber()&&(a=t[n])}),a}function e(t){var e=t.length;if(0===e)return null;if(1===e)return t[0];var a=t[0];return t.forEach(function(e,n){GamePage.instance.animals[Object.keys(e)[0]].getNumber()>GamePage.instance.animals[Object.keys(a)[0]].getNumber()&&(a=t[n])}),a}function a(t,e){if(!t)return console.log("不存在被吃棋子，则返回所有路径",e),e;var a=[];return e.forEach(function(e,n){Object.keys(e)[0]===t&&a.push(e)}),a}function n(){var t=[];return Object.keys(GamePage.instance.animals).forEach(function(e,a){GamePage.instance.animals[e].getIsOpen()===!0&&e.slice(0,1)===DataMgr.getInstance().userData.matchingData.enemyTeam&&t.push(GamePage.instance.animals[e])}),t}function i(t){function e(e,i){if(e.getIsOpen()&&e.getColor()!==DataMgr.getInstance().userData.matchingData.enemyTeam)if(t.getNumber()>=e.getNumber())if(8===Number(t.getNumber())&&1===Number(e.getNumber())){var o={};o[s]=i,n.push(o)}else{var o={};o[s]=i,a.push(o)}else if(t.getNumber()<e.getNumber())if(1===Number(t.getNumber())&&8===Number(e.getNumber())){var o={};o[s]=i,a.push(o)}else{var o={};o[s]=i,n.push(o)}}var a=[],n=[],i=[],s=t.getId(),o=DataMgr.getInstance().userData.matchingData.chessData,r=Number(o[s].slice(0,1))-1+o[s].slice(1),h=Number(o[s].slice(0,1))+1+o[s].slice(1),d=o[s].slice(0,1)+(Number(o[s].slice(1))-1),c=o[s].slice(0,1)+(Number(o[s].slice(1))+1);return Object.keys(GamePage.instance.animals).forEach(function(t,a){if(o[t]===d){var n=GamePage.instance.animals[t];e(n,t)}else if(o[t]===c){var n=GamePage.instance.animals[t];e(n,t)}else if(o[t]===r){var n=GamePage.instance.animals[t];e(n,t)}else if(o[t]===h){var n=GamePage.instance.animals[t];e(n,t)}}),Object.keys(GamePage.instance.lawns).forEach(function(t,e){if(t===d){var a={};a[s]=t,i.push(a)}else if(t===c){var a={};a[s]=t,i.push(a)}else if(t===r){var a={};a[s]=t,i.push(a)}else if(t===h){var a={};a[s]=t,i.push(a)}}),{canEatEnemy:a,beEatedEnemy:n,lawn:i}}for(var s=[],o=[],r=[],h=n(),d=0,c=h.length;c>d;d++){var g=i(h[d]);s=s.concat(g.canEatEnemy),o=o.concat(g.beEatedEnemy),r=r.concat(g.lawn)}var l=e(o),u={canEatEnemyAnimal:t(s),beEatedAnimal:l,canEatLawn:a(l?Object.keys(l)[0]:null,r)};return l||console.log("res",u),u}var a=this;if(GamePage.instance.getCanPlayTeam()===DataMgr.getInstance().userData.matchingData.enemyTeam)var n=setTimeout(function(){t.call(a),clearTimeout(n),n=null},1e3)},t.prototype.getOneEgg=function(){var t=!1;if(Object.keys(GamePage.instance.animals).forEach(function(e,a){t||GamePage.instance.animals[e].getIsOpen()!==!1||(t=!0)}),t){var e=[];return Object.keys(GamePage.instance.animals).forEach(function(t,a){GamePage.instance.animals[t].getIsOpen()===!1&&e.push(t)}),e[_.random(0,e.length-1)]}return null},t.prototype.clickEgg=function(t){GamePage.instance.removePrevPlayChess(),t.openEgg(!0,function(){GamePage.instance.addPrevPlayChess(t.x,t.y),GamePage.instance.changeCanPlayTeam()})},t.prototype.startRamdonTimer=function(t){var e=this;this.ramdonTimer=setTimeout(function(){t(),clearTimeout(e.ramdonTimer),e.ramdonTimer=null,e.startRamdonTimer(t)},_.random(2e3,6e3))},t.prototype.stopRamdonTimer=function(){clearTimeout(this.ramdonTimer),this.ramdonTimer=null},t.prototype.getRandomChessData=function(){function t(t){var e=_.random(0,t.length-1),a=t[e];return t.splice(e,1),a}var e={},a=["b_1","b_2","b_3","b_4","b_5","b_6","b_7","b_8","r_1","r_2","r_3","r_4","r_5","r_6","r_7","r_8"],n=["00","01","02","03","10","11","12","13","20","21","22","23","30","31","32","33"];return a.forEach(function(a,i){var s=t(n);e[a]=s}),e},t.prototype.moveAnimal=function(t,e){GamePage.instance.floatAnimal(t),e instanceof Animal?GamePage.instance.eatOtherChess(e):GamePage.instance.eatLawn(e)},t.prototype.robotNumberLess=function(){for(var t=0,e=0,a=0,n=Object.keys(GamePage.instance.animals);a<n.length;a++){var i=n[a];i.slice(0,1)===DataMgr.getInstance().userData.matchingData.enemyTeam?t++:e++}return e>=t?!0:!1},t}();__reflect(Robot.prototype,"Robot");var AwardPage=function(t){function e(e,a){var n=t.call(this)||this;return n.addEventListener(egret.Event.ADDED_TO_STAGE,function(t){AudioMgr.getInstance().showAward(),n.addBg(),n.addawardObj(e),n.addGetBtn(a),Main.hideGameClub()},n),n.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(t){Main.showGameClub()},n),n}return __extends(e,t),e.prototype.addBg=function(){var t=new Mask;this.addChild(t);var e=GlueUtils.createBitmapByName("congratTitle_png");e.width=614,e.height=160,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.x=Main.StageWidth/2,e.y=Main.BaseLine-330,this.addChild(e);var a=GlueUtils.createBitmapByName("ratate2_png");a.width=650,a.height=650,a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,a.x=Main.StageWidth/2,a.y=Main.BaseLine,this.addChild(a),egret.Tween.get(a,{loop:!0}).to({rotation:360},3e3)},e.prototype.addawardObj=function(t){t.width=650,t.height=650,t.anchorOffsetX=t.width/2,t.anchorOffsetY=t.height/2,t.x=Main.StageWidth/2,t.y=Main.BaseLine,this.addChild(t)},e.prototype.addGetBtn=function(t){var e=GlueUtils.createBitmapByName("getGift1_png");e.width=374,e.height=138,e.anchorOffsetX=e.width/2,e.anchorOffsetY=e.height/2,e.x=Main.StageWidth/2,e.y=Main.BaseLine+420,e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,function a(){t&&(AudioMgr.getInstance().userSkin(),t()),e.removeEventListener(egret.TouchEvent.TOUCH_TAP,a,this),GlueUtils.RemoveChild(this)},this),this.addChild(e)},e}(egret.DisplayObjectContainer);__reflect(AwardPage.prototype,"AwardPage");var EverydayGiftWin=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,function(t){Main.hideGameClub(),e.addMask(),e.windowInit(),e.leftToCenter(e.window),Main.hideGameClub()},e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(t){Main.showGameClub()},e),e}return __extends(e,t),e.prototype.addMask=function(){var t=new Mask;t.touchEnabled=!0,t.once(egret.TouchEvent.TOUCH_TAP,function(){var t=this;this.centerToRight(this.window,function(){GlueUtils.RemoveChild(t)})},this),this.addChild(t)},e.prototype.windowInit=function(){GlueUtils.RemoveChild(this.getChildByName("WINDOW")),this.window=new egret.DisplayObjectContainer,this.window.touchEnabled=!0,this.window.width=Main.StageWidth,this.window.height=Main.StageHeight,this.window.name="WINDOW",this.addChild(this.window);var t=GlueUtils.createIcon({url:"signBg_png",width:526,height:746,x:this.window.width/2,y:this.window.height/2});this.window.addChild(t);var e=GlueUtils.createIcon({url:"window_return_png",width:90,height:90,x:76,y:100*Main.K_H});e.touchEnabled=!0,e.once(egret.TouchEvent.TOUCH_TAP,function(){var t=this;this.centerToRight(this.window,function(){GlueUtils.RemoveChild(t)})},this),this.window.addChild(e);for(var a=0;7>a;a++){var n=GlueUtils.createIcon({url:"sign_"+(a+1)+"_png",width:118,height:178,x:6===a?375:3>a?224+154*a:224+154*(a-3),y:6===a?this.window.height/2+264:3>a?this.window.height/2-150:this.window.height/2+70});this.window.addChild(n),a<DataMgr.getInstance().userData.signInNumber&&(n.filters=[new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0])])}var i=this;this.getAwardBtn=GlueUtils.creatButton({url:"signGet_png",width:352,height:102,x:i.window.x+i.window.width/2,y:i.window.height/2+470}),this.window.addChild(this.getAwardBtn),DataMgr.getInstance().userData.signIn?(this.getAwardBtn.touchEnabled=!1,this.getAwardBtn.filters=[new egret.ColorMatrixFilter([.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0])]):(this.getAwardBtn.touchEnabled=!0,this.getAwardBtn.once(egret.TouchEvent.TOUCH_TAP,this.getAward,this))},e.prototype.getAward=function(){var t=this;wx.showLoading({title:"领取中"}),Net.signIn().then(function(){switch(wx.hideLoading(),DataMgr.getInstance().userData.signIn=!0,DataMgr.getInstance().userData.signInNumber+=1,t.window.removeChildren(),t.windowInit(),t.window.x=(Main.StageWidth-t.window.width)/2,t.window.y=(Main.StageHeight-t.window.height)/2,wx.showToast({title:"领取成功",icon:"success",duration:2500}),DataMgr.getInstance().userData.signInNumber){case 1:DataMgr.getInstance().userData.coin+=100,IndexPage.instance.updateDiamondText();break;case 2:DataMgr.getInstance().userData.gameProps.reviveCard+=1;break;case 3:DataMgr.getInstance().userData.gameProps.mouseCard+=1;break;case 4:DataMgr.getInstance().userData.coin+=200,IndexPage.instance.updateDiamondText();break;case 5:DataMgr.getInstance().userData.gameProps.reviveCard+=2;break;case 6:DataMgr.getInstance().userData.gameProps.mouseCard+=2;break;default:DataMgr.getInstance().userData.gameProps.countCard+=2}})["catch"](function(){wx.hideLoading(),wx.showToast({title:"领取失败，请稍后再试",icon:"none",duration:3e3})})},e}(ModalWindow);__reflect(EverydayGiftWin.prototype,"EverydayGiftWin");var FreeLottoWind=function(t){function e(){var e=t.call(this)||this;return e.globalClickPermission=!0,e.addEventListener(egret.Event.ADDED_TO_STAGE,function(t){Main.hideGameClub(),e.addMask(),e.windowInit(),e.leftToCenter(e.window),Main.hideGameClub()},e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(t){Main.showGameClub()},e),e}return __extends(e,t),e.prototype.addMask=function(){var t=new Mask;t.touchEnabled=!0,t.once(egret.TouchEvent.TOUCH_TAP,function(){var t=this;this.centerToRight(this.window,function(){GlueUtils.RemoveChild(t)})},this),this.addChild(t)},e.prototype.windowInit=function(){this.window=new egret.DisplayObjectContainer,this.window.touchEnabled=!0,this.window.width=Main.StageWidth,this.window.height=Main.StageHeight,this.addChild(this.window);var t=GlueUtils.createImg("turnTitle_png",530,154,this.window.width/2,Main.BaseLine-380);this.window.addChild(t);var e=GlueUtils.createImg("window_return_png",90,90,76,100*Main.K_H);e.touchEnabled=!0,e.once(egret.TouchEvent.TOUCH_TAP,function(){var t=this;this.centerToRight(this.window,function(){GlueUtils.RemoveChild(t)})},this),this.window.addChild(e),this.turnPlanet=GlueUtils.createImg("turnPlane_png",600,600,this.window.width/2,Main.BaseLine),this.window.addChild(this.turnPlanet);var a=GlueUtils.createImg("turnPoint_png",120,166,this.window.width/2,Main.BaseLine);this.window.addChild(a),this.startLottoBtn=GlueUtils.createImg(DataMgr.getInstance().userData.shareTurnNumber<=0||1===DataMgr.getInstance().gameData_LG.isAudit?"seeVideoLotto_png":"inviteGiftWindowShare_png",390,100,this.window.width/2,Main.BaseLine+430),this.startLottoBtn.touchEnabled=!0;var n=wx.createRewardedVideoAd({adUnitId:"adunit-6e602366a041e532"});this.startLottoBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){if(!this.globalClickPermission)return void wx.showToast({title:"请稍后再试",icon:"none",duration:1500});var t=this;DataMgr.getInstance().userData.shareTurnNumber<=0||1===DataMgr.getInstance().gameData_LG.isAudit?(this.globalClickPermission=!1,n.load().then(function(){return n.show()})["catch"](function(t){return console.log(t.errMsg)}),n.onError(function(e){t.globalClickPermission=!0,console.error(e),wx.showToast({title:"获取广告失败",icon:"none",duration:3e3})}),n.onClose(function e(a){t.globalClickPermission=!0,n.offClose(e),a&&a.isEnded||void 0===a?t.turnTurnPlateOnce():console.log("中途退出")})):(this.globalClickPermission=!1,this.shareOnshowCallBackBind=this.shareOnhideCallBack.bind(this,(new Date).getTime()),wx.onShow(this.shareOnshowCallBackBind),wx.shareAppMessage({title:DataMgr.getInstance().gameData_LG.shareInfo.title,imageUrl:DataMgr.getInstance().gameData_LG.shareInfo.url,query:"uid="+DataMgr.getInstance().userData.uid}))},this),this.window.addChild(this.startLottoBtn)},e.prototype.shareOnhideCallBack=function(t){this.globalClickPermission=!0,wx.offShow(this.shareOnshowCallBackBind),(new Date).getTime()-t<1e3?wx.showToast({title:"分享失败",icon:"none",duration:1500}):(DataMgr.getInstance().userData.shareTurnNumber--,Net.reduceShareTurnNumber(),(DataMgr.getInstance().userData.shareTurnNumber<=0||1===DataMgr.getInstance().gameData_LG.isAudit)&&(this.startLottoBtn.texture=RES.getRes("seeVideoLotto_png")),this.turnTurnPlateOnce())},e.prototype.turnTurnPlateOnce=function(){var t=this;this.globalClickPermission=!1;var e=this.getTypeAndOffAngle();egret.Tween.get(this.turnPlanet).to({rotation:-e[1]},3600,egret.Ease.cubicInOut).wait(800).call(function(){switch(t.globalClickPermission=!0,e[0]){case 0:wx.showToast({title:"啥也没抽到",icon:"none",duration:1500});break;case 1:var a=new egret.DisplayObjectContainer;a.width=650,a.height=650;var n=GlueUtils.createImg("award_mouse_png",250,340,a.width/2,a.height/2);a.addChild(n);var i=new egret.TextField;i.width=a.width,i.textAlign=egret.HorizontalAlign.CENTER,i.y=520,i.size=50,i.bold=!0,i.textColor=16777215,i.strokeColor=13923636,i.stroke=2,i.text="老鼠夹1个",a.addChild(i);var s=new AwardPage(a,function(){DataMgr.getInstance().userData.gameProps.mouseCard+=1,wx.showToast({title:"领取成功",icon:"success",duration:1500})});t.addChild(s);break;case 2:var o=new egret.DisplayObjectContainer;o.width=650,o.height=650;var r=GlueUtils.createImg("award_coin_png",320,250,o.width/2,o.height/2);o.addChild(r);var h=new egret.TextField;h.width=o.width,h.textAlign=egret.HorizontalAlign.CENTER,h.y=520,h.size=50,h.bold=!0,h.textColor=16777215,h.strokeColor=13923636,h.stroke=2,h.text="金币+200",o.addChild(h);var d=new AwardPage(o,function(){DataMgr.getInstance().userData.coin+=200,IndexPage.instance.updateDiamondText(),wx.showToast({title:"领取成功",icon:"success",duration:1500})});t.addChild(d);break;case 3:var c=new egret.DisplayObjectContainer;c.width=650,c.height=650;var g=GlueUtils.createImg("mouse_revive_png",320,250,c.width/2,c.height/2);c.addChild(g);var l=new egret.TextField;l.width=c.width,l.textAlign=egret.HorizontalAlign.CENTER,l.y=520,l.size=50,l.bold=!0,l.textColor=16777215,l.strokeColor=13923636,l.stroke=2,l.text="续命丸1颗",c.addChild(l);var u=new AwardPage(c,function(){DataMgr.getInstance().userData.gameProps.reviveCard+=1,wx.showToast({title:"领取成功",icon:"success",duration:1500})
});t.addChild(u);break;case 4:var m=new egret.DisplayObjectContainer;m.width=650,m.height=650;var p=GlueUtils.createImg("award_calcu_png",260,250,m.width/2,m.height/2);m.addChild(p);var v=new egret.TextField;v.width=m.width,v.textAlign=egret.HorizontalAlign.CENTER,v.y=520,v.size=50,v.bold=!0,v.textColor=16777215,v.strokeColor=13923636,v.stroke=2,v.text="记分牌1个",m.addChild(v);var w=new AwardPage(m,function(){DataMgr.getInstance().userData.gameProps.countCard+=1,wx.showToast({title:"领取成功",icon:"success",duration:1500})});t.addChild(w);break;case 5:var f=new egret.DisplayObjectContainer;f.width=650,f.height=650;var D=GlueUtils.createImg("award_mouse_png",250,340,f.width/2,f.height/2);f.addChild(D);var y=new egret.TextField;y.width=f.width,y.textAlign=egret.HorizontalAlign.CENTER,y.y=520,y.size=50,y.bold=!0,y.textColor=16777215,y.strokeColor=13923636,y.stroke=2,y.text="老鼠夹1个",f.addChild(y);var _=new AwardPage(f,function(){DataMgr.getInstance().userData.gameProps.mouseCard+=1,wx.showToast({title:"领取成功",icon:"success",duration:1500})});t.addChild(_);break;case 6:var T=new egret.DisplayObjectContainer;T.width=650,T.height=650;var I=GlueUtils.createImg("award_coin_png",320,250,T.width/2,T.height/2);T.addChild(I);var C=new egret.TextField;C.width=T.width,C.textAlign=egret.HorizontalAlign.CENTER,C.y=520,C.size=50,C.bold=!0,C.textColor=16777215,C.strokeColor=13923636,C.stroke=2,C.text="金币+100",T.addChild(C);var M=new AwardPage(T,function(){DataMgr.getInstance().userData.coin+=100,IndexPage.instance.updateDiamondText(),wx.showToast({title:"领取成功",icon:"success",duration:1500})});t.addChild(M);break;case 7:var x=new egret.DisplayObjectContainer;x.width=650,x.height=650;var E=GlueUtils.createImg("mouse_revive_png",320,250,x.width/2,x.height/2);x.addChild(E);var b=new egret.TextField;b.width=x.width,b.textAlign=egret.HorizontalAlign.CENTER,b.y=520,b.size=50,b.bold=!0,b.textColor=16777215,b.strokeColor=13923636,b.stroke=2,b.text="续命丸1颗",x.addChild(b);var G=new AwardPage(x,function(){DataMgr.getInstance().userData.gameProps.reviveCard+=1,wx.showToast({title:"领取成功",icon:"success",duration:1500})});t.addChild(G)}})},e.prototype.getTypeAndOffAngle=function(){var t=Object.keys(e.awardsPercent).length,a=Math.random(),n=e.awardsPercent,i=BaseUtils.getRomNumberBetween(0,360/t),s=[];if(a<n.nothing){var o=0,r=360*o/t+i+3600;s=[o,r]}else if(a<n.mouseCard1&&a>=n.nothing){var o=1,r=360*o/t+i+3600;s=[o,r]}else if(a<n.coin_200&&a>=n.mouseCard1){var o=2,r=360*o/t+i+3600;s=[o,r]}else if(a<n.reviveCard1&&a>=n.coin_200){var o=3,r=360*o/t+i+3600;s=[o,r]}else if(a<n.countCard&&a>=n.reviveCard1){var o=4,r=360*o/t+i+3600;s=[o,r]}else if(a<n.mouseCard2&&a>=n.countCard){var o=5,r=360*o/t+i+3600;s=[o,r]}else if(a<n.coin_100&&a>=n.mouseCard2){var o=6,r=360*o/t+i+3600;s=[o,r]}else if(a<n.reviveCard2&&a>=n.coin_100){var o=7,r=360*o/t+i+3600;s=[o,r]}return s},e.awardsPercent={nothing:.05,mouseCard1:.1,coin_200:.3,reviveCard1:.35,countCard:.4,mouseCard2:.45,coin_100:.95,reviveCard2:1},e}(ModalWindow);__reflect(FreeLottoWind.prototype,"FreeLottoWind");var InviteGiftWin=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,function(t){e.addMask(),e.windowInit(),e.updateList(),e.inviteFriendsBtn(),e.leftToCenter(e.window),Main.hideGameClub()},e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(t){wx.hideLoading(),Main.showGameClub()},e),e}return __extends(e,t),e.prototype.addMask=function(){var t=new Mask;t.touchEnabled=!0,t.once(egret.TouchEvent.TOUCH_TAP,function(){var t=this;this.centerToRight(this.window,function(){GlueUtils.RemoveChild(t)})},this),this.addChild(t)},e.prototype.windowInit=function(){this.window=new egret.DisplayObjectContainer,this.window.touchEnabled=!0,this.window.width=720,this.window.height=990,this.addChild(this.window);var t=GlueUtils.createImg("inviteGiftWindow_png",this.window.width,this.window.height,this.window.width/2,this.window.height/2);this.window.addChild(t);var e=GlueUtils.createImg("window_close_png",90,90,656,82);e.touchEnabled=!0,e.once(egret.TouchEvent.TOUCH_TAP,function(){var t=this;this.centerToRight(this.window,function(){GlueUtils.RemoveChild(t)})},this),this.window.addChild(e)},e.prototype.addList=function(){for(var t=new egret.DisplayObjectContainer,e=RES.getRes("inviteGiftWindowItem_png"),a=DataMgr.getInstance().userData.inviteFriendsStatus,n=function(n){var s=new egret.Bitmap(e);s.width=614,s.height=120,s.x=0,s.y=136*n,t.addChild(s);var o=new egret.TextField;if(o.x=48,o.y=40+136*n,o.textColor=7719421,o.size=40,o.text=n+1+"",t.addChild(o),a[n].avatar)GlueUtils.createBitmapByUrl(a[n].avatar).then(function(e){e.width=90,e.height=90,e.x=146,e.y=62+136*n,t.addChild(e),GlueUtils.rectToCircle(e)});else{var r=GlueUtils.createBitmapByName("willBeInviteFriends_png");r.width=90,r.height=90,r.x=146,r.y=62+136*n,t.addChild(r),GlueUtils.rectToCircle(r)}var h=GlueUtils.createBitmapByName("award_coin_png");h.width=50,h.height=44,h.x=220,h.y=42+136*n,t.addChild(h);var d=new egret.TextField;d.x=284,d.y=46+136*n,d.textColor=2199756,d.size=34,d.text="x"+a[n].giftNumber,t.addChild(d);var c=GlueUtils.createBitmapByName(0===a[n].status?"invite_unGet_png":1===a[n].status?"getGift2_png":"invite_gotted_png");c.width=126,c.height=66,c.x=450,c.y=30+136*n,t.addChild(c),1===a[n].status&&(c.touchEnabled=!0,c.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){a[n].status=2,Net.storeInviteFriendsData().then(function(t){console.log("邀请信息保存结果："+t)}),c.texture=RES.getRes("invite_gotted_png"),DataMgr.getInstance().userData.coin+=a[n].giftNumber,IndexPage.instance.updateDiamondText()},i))},i=this,s=0;10>s;s++)n(s);var o=new egret.ScrollView;o.width=614,o.height=662,o.x=48,o.y=170,o.name="scrollView",o.removeContent(),o.setContent(t),this.getChildByName("scrollView")&&this.removeChild(this.getChildByName("scrollView")),this.window.addChild(o)},e.prototype.inviteFriendsBtn=function(){var t=GlueUtils.createBitmapByName("inviteGiftWindowShare_png");t.width=260,t.height=80,t.x=(this.window.width-t.width)/2,t.y=860,t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.inviteFriends,this),this.window.addChild(t)},e.prototype.inviteFriends=function(){wx.shareAppMessage({title:DataMgr.getInstance().gameData_LG.shareInfo.title,imageUrl:DataMgr.getInstance().gameData_LG.shareInfo.url,query:"uid="+DataMgr.getInstance().userData.uid})},e.prototype.updateList=function(){var t=this;wx.showLoading({title:"数据更新中.."}),Net.login().then(function(e){wx.hideLoading(),DataMgr.getInstance().userData.inviteFriendsStatus=void 0!==e.data.userdata.invite_info?JSON.parse(e.data.userdata.invite_info):DataMgr.getInstance().userData.inviteFriendsStatus,t.addList()},function(){wx.hideLoading(),wx.showToast({title:"数据获取失败,请稍后重试",icon:"none",duration:3e3})})},e}(ModalWindow);__reflect(InviteGiftWin.prototype,"InviteGiftWin");var PersonCenter=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,function(t){e.addMask(),e.windowInit(),e.updateData(),e.leftToCenter(e.window),Main.hideGameClub()},e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(t){Main.showGameClub()},e),e}return __extends(e,t),e.prototype.addMask=function(){var t=new Mask;t.touchEnabled=!0,t.once(egret.TouchEvent.TOUCH_TAP,function(){var t=this;this.centerToRight(this.window,function(){GlueUtils.RemoveChild(t)})},this),this.addChild(t)},e.prototype.windowInit=function(){var t=this;GlueUtils.RemoveChild(this.getChildByName("WINDOW")),this.window=new egret.DisplayObjectContainer,this.window.touchEnabled=!0,this.window.width=Main.StageWidth,this.window.height=Main.StageHeight,this.window.name="WINDOW",this.addChild(this.window);var e=GlueUtils.createIcon({url:"personCenterBg_png",width:620,height:860,x:this.window.width/2,y:this.window.height/2});this.window.addChild(e);var a=GlueUtils.createIcon({url:"window_return_png",width:90,height:90,x:76,y:100*Main.K_H});a.touchEnabled=!0,a.once(egret.TouchEvent.TOUCH_TAP,function(){var t=this;this.centerToRight(this.window,function(){GlueUtils.RemoveChild(t)})},this),this.window.addChild(a),GlueUtils.createBitmapByUrl(DataMgr.getInstance().userData.avatarUrl).then(function(e){e.width=e.height=190,e.x=Main.StageWidth/2,e.y=Main.BaseLine-430;var a=new egret.Shape;a.graphics.beginFill(16299012),a.graphics.lineStyle(14,16299012),a.graphics.drawCircle(e.x,e.y,.5*e.width),a.graphics.endFill(),t.window.addChild(a),t.window.addChild(e),GlueUtils.rectToCircle(e)});var n=new egret.TextField;n.width=this.window.width,n.textAlign=egret.HorizontalAlign.CENTER,n.x=0,n.y=Main.BaseLine-300,n.size=34,n.textColor=7683393,n.text=DataMgr.getInstance().gameData_LG.levelTitle[BusUtils.getLevelByStar()]+" -- "+DataMgr.getInstance().userData.nickName,this.window.addChild(n);var i=new egret.TextField;i.x=360,i.y=Main.BaseLine-430+220,i.size=34,i.textColor=7683393,i.text=DataMgr.getInstance().userData.coin+"",this.window.addChild(i),this.playTimesText=new egret.TextField,this.playTimesText.x=182,this.playTimesText.y=Main.BaseLine-430+336,this.playTimesText.size=34,this.playTimesText.textColor=7683393,this.playTimesText.text="场数：0",this.window.addChild(this.playTimesText),this.tieTimesText=new egret.TextField,this.tieTimesText.x=424,this.tieTimesText.y=Main.BaseLine-430+336,this.tieTimesText.size=34,this.tieTimesText.textColor=7683393,this.tieTimesText.text="平局：0",this.window.addChild(this.tieTimesText),this.winTimesText=new egret.TextField,this.winTimesText.x=182,this.winTimesText.y=Main.BaseLine-430+418,this.winTimesText.size=34,this.winTimesText.textColor=7683393,this.winTimesText.text="胜利：0",this.window.addChild(this.winTimesText),this.winRateText=new egret.TextField,this.winRateText.x=424,this.winRateText.y=Main.BaseLine-430+418,this.winRateText.size=34,this.winRateText.textColor=7683393,this.winRateText.text="胜率：0%",this.window.addChild(this.winRateText);var s=new egret.TextField;s.x=166,s.y=Main.BaseLine-430+742,s.size=36,s.textColor=7683393,s.text=DataMgr.getInstance().userData.gameProps.countCard+"",this.window.addChild(s);var o=new egret.TextField;o.x=362,o.y=Main.BaseLine-430+742,o.size=36,o.textColor=7683393,o.text=DataMgr.getInstance().userData.gameProps.mouseCard+"",this.window.addChild(o);var r=new egret.TextField;r.x=564,r.y=Main.BaseLine-430+742,r.size=36,r.textColor=7683393,r.text=DataMgr.getInstance().userData.gameProps.reviveCard+"",this.window.addChild(r)},e.prototype.updateData=function(){var t=this;Net.getUserPlayInfo().then(function(e){var a=e.data.win,n=e.data.lose,i=e.data.flat;t.playTimesText.text="场数："+(a+n+i),t.tieTimesText.text="平局："+i,t.winTimesText.text="胜利："+a,t.winRateText.text="胜率："+(a+n+i===0?0:Math.floor(100*a/(a+n+i)))+"%"})["catch"](function(t){console.error("getUserPlayInfo接口报错",t)})},e}(ModalWindow);__reflect(PersonCenter.prototype,"PersonCenter");var Shop=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,function(t){e.addMask(),e.windowInit(),e.leftToCenter(e.window),Main.hideGameClub()},e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(t){Main.showGameClub()},e),e}return __extends(e,t),e.prototype.addMask=function(){var t=new Mask;t.touchEnabled=!0,t.once(egret.TouchEvent.TOUCH_TAP,function(){var t=this;this.centerToRight(this.window,function(){GlueUtils.RemoveChild(t)})},this),this.addChild(t)},e.prototype.windowInit=function(){GlueUtils.RemoveChild(this.getChildByName("WINDOW")),this.window=new egret.DisplayObjectContainer,this.window.touchEnabled=!0,this.window.width=Main.StageWidth,this.window.height=Main.StageHeight,this.window.name="WINDOW",this.addChild(this.window);var t=GlueUtils.createIcon({url:"shopBg_png",width:634,height:992,x:this.window.width/2,y:this.window.height/2});this.window.addChild(t);var e=GlueUtils.createIcon({url:"window_return_png",width:90,height:90,x:76,y:100*Main.K_H});e.touchEnabled=!0,e.once(egret.TouchEvent.TOUCH_TAP,function(){var t=this;this.centerToRight(this.window,function(){GlueUtils.RemoveChild(t)})},this),this.window.addChild(e);for(var a=0;3>a;a++){var n=this.buy.bind(this,a),i=GlueUtils.creatButton({url:"shop_buy_png",width:220,height:76,x:0,y:0,filter:[],callBack:n});GlueUtils.removedListener(i,egret.TouchEvent.TOUCH_TAP,n,this.window),this.window.addChild(i);var s=new egret.TextField;switch(s.text="300",s.textColor=14049049,s.size=34,this.window.addChild(s),a){case 0:s.x=228,s.y=Main.BaseLine-14,i.x=230,i.y=Main.BaseLine+6;break;case 1:s.x=540,s.y=Main.BaseLine-14,i.x=534,i.y=Main.BaseLine+6;break;case 2:s.x=374,s.y=Main.BaseLine+346,i.x=Main.StageWidth/2,i.y=Main.BaseLine+366}}},e.prototype.buy=function(t){var e=this,a=300;wx.showModal({title:"提示",content:"您将花费"+a+"颗金币购买该商品",success:function(n){if(n.confirm===!0)if(DataMgr.getInstance().userData.coin>=a)switch(DataMgr.getInstance().userData.coin-=a,IndexPage.instance.updateDiamondText(),t){case 0:DataMgr.getInstance().userData.gameProps.countCard+=1,e.addChild(new Toast("记牌器购买成功"));break;case 1:DataMgr.getInstance().userData.gameProps.mouseCard+=1,e.addChild(new Toast("老鼠夹购买成功"));break;case 2:DataMgr.getInstance().userData.gameProps.reviveCard+=1,e.addChild(new Toast("续命丹购买成功"))}else Main.dimondLackTips(IndexPage.instance);n.cancel===!0&&wx.showToast({title:"已取消",icon:"none",duration:1500})},fail:function(t){console.error(t)}})},e}(ModalWindow);__reflect(Shop.prototype,"Shop");var SkinBox=function(t){function e(e,a,n,i){var s=t.call(this)||this;return s.name=e,s.touchEnabled=!0,s.width=320,s.height=480,s.x=n,s.y=i,s.addBg(a),s}return __extends(e,t),e.prototype.addBg=function(t){this.bg=GlueUtils.createBitmapByName(t),this.bg.width=320,this.bg.height=380,this.addChild(this.bg),this.buySkinBtn=GlueUtils.createBitmapByName("buySkin_png"),this.buySkinBtn.width=320,this.buySkinBtn.height=80,this.buySkinBtn.y=400,this.addChild(this.buySkinBtn)},e.prototype.changeBuySkinBtn=function(t){this.buySkinBtn.texture=RES.getRes(t)},e.prototype.addNeedsDiamondNumber=function(){this.buyNeedsDiamondNumber=new egret.TextField,this.buyNeedsDiamondNumber.x=192,this.buyNeedsDiamondNumber.y=422,this.buyNeedsDiamondNumber.text="x"+DataMgr.getInstance().userData.skinData[this.name].diamondCost,this.buyNeedsDiamondNumber.textColor=16777215,this.buyNeedsDiamondNumber.size=36,this.addChild(this.buyNeedsDiamondNumber)},e.prototype.removeNeedsDiamondNumber=function(){GlueUtils.RemoveChild(this.buyNeedsDiamondNumber)},e.prototype.addUsedIcon=function(){this.usedIcon=GlueUtils.createBitmapByName("skinUsed_png"),this.usedIcon.width=60,this.usedIcon.height=60,this.usedIcon.x=250,this.usedIcon.y=308,this.addChild(this.usedIcon)},e.prototype.removeUsedIcon=function(){GlueUtils.RemoveChild(this.usedIcon)},e}(egret.DisplayObjectContainer);__reflect(SkinBox.prototype,"SkinBox");var SkinMgrPage=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,function(t){e.addMask(),e.windowInit(),e.leftToCenter(e.window)},e),e.addEventListener(egret.Event.REMOVED_FROM_STAGE,function(t){},e),e}return __extends(e,t),e.prototype.addMask=function(){var t=new Mask;t.touchEnabled=!0,t.once(egret.TouchEvent.TOUCH_TAP,function(){var t=this;this.centerToRight(this.window,function(){GlueUtils.RemoveChild(t)})},this),this.addChild(t)},e.prototype.windowInit=function(){this.window=new egret.DisplayObjectContainer,this.window.touchEnabled=!0,this.window.width=750,this.window.height=1268,this.window.x=(Main.StageWidth-this.window.width)/2,this.window.y=(Main.StageHeight-this.window.height)/2,this.addChild(this.window);var t=GlueUtils.createIcon("skinMgrBg_png",this.window.width,this.window.height,this.window.width/2,this.window.height/2);this.window.addChild(t);var e=GlueUtils.createIcon("closeSkinMgrBg_png",60,60,680,70);e.touchEnabled=!0,e.once(egret.TouchEvent.TOUCH_TAP,function(){var t=this;this.centerToRight(this.window,function(){GlueUtils.RemoveChild(t)})},this),this.window.addChild(e),this.skinBox0=new SkinBox("keySkin0","keySkin0_png",46,240),this.skinBox1=new SkinBox("keySkin1","keySkin1_png",386,240),this.skinBox2=new SkinBox("keySkin2","keySkin2_png",46,740),this.skinBox3=new SkinBox("keySkin3","keySkin3_png",386,740),this.window.addChild(this.skinBox0),this.window.addChild(this.skinBox1),this.window.addChild(this.skinBox2),this.window.addChild(this.skinBox3),this.skinStatusInt(),this.listenWindowEvent()},e.prototype.skinStatusInt=function(){for(var t in DataMgr.getInstance().userData.skinData){var e=DataMgr.getInstance().userData.skinData[t],a=this.window.getChildByName(t);e.isOwn?(a.changeBuySkinBtn("hasOwn_png"),a.removeNeedsDiamondNumber()):(a.changeBuySkinBtn("buySkin_png"),a.addNeedsDiamondNumber()),e.isUsed?(a.removeUsedIcon(),a.addUsedIcon()):a.removeUsedIcon()}},e.prototype.listenWindowEvent=function(){this.window.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.window.touchEnabled=!0;var e=t.target;if(e instanceof SkinBox)if(DataMgr.getInstance().userData.skinData[e.name].isOwn){for(var a in DataMgr.getInstance().userData.skinData)e.name===a?DataMgr.getInstance().userData.skinData[a].isUsed=!0:DataMgr.getInstance().userData.skinData[a].isUsed=!1;this.skinStatusInt(),Net.storeSkinData(),AudioMgr.getInstance().userSkin()}else{var n=this;wx.showModal({title:"提示",content:"您将花费"+DataMgr.getInstance().userData.skinData[e.name].diamondCost+"颗金币购买该皮肤",success:function(t){if(t.confirm===!0){var a=DataMgr.getInstance().userData.skinData[e.name].diamondCost;DataMgr.getInstance().userData.coin>=a?(DataMgr.getInstance().userData.coin-=a,IndexPage.instance.updateDiamondText(),Net.setDiamond(-a),DataMgr.getInstance().userData.skinData[e.name].isOwn=!0,n.skinStatusInt(),Net.storeSkinData()):Main.dimondLackTips(IndexPage.instance)}t.cancel===!0&&wx.showToast({title:"已取消",icon:"none",duration:1e3})},fail:function(t){console.error(t)}})}},this)},e}(ModalWindow);__reflect(SkinMgrPage.prototype,"SkinMgrPage"),window.Main=Main;